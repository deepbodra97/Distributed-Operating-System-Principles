function ignore(){}function id(n){return n}function fst(n){return n[0]}function snd(n){return n[1]}function trd(n){return n[2]}IntelliFactory={Runtime:{Ctor:function(n,t){return n.prototype=t.prototype,n},Class:function(n,t,i){var u=n,f,r,e;if(t){u=new t;for(f in n)u[f]=n[f]}if(r=function(n){if(n)for(var t in n)this[t]=n[t]},r.prototype=u,i)for(e in i)r[e]=i[e];return r},Clone:function(n){var t={};for(var i in n)t[i]=n[i];return t},NewObject:function(n){for(var i={},t=0;t<n.length;t++)i[n[t][0]]=n[t][1];return i},DeleteEmptyFields:function(n,t){for(var r,i=0;i<t.length;i++)r=t[i],n[r]===void 0&&delete n[r];return n},GetOptional:function(n){return n===void 0?null:{$:1,$0:n}},SetOptional:function(n,t,i){i?n[t]=i.$0:delete n[t]},SetOrDelete:function(n,t,i){i===void 0?delete n[t]:n[t]=i},Apply:function(n,t,i){return n.apply(t,i)},Bind:function(n){return function(){return n.apply(this,arguments)}},CreateFuncWithArgs:function(n){return function(){return n(Array.prototype.slice.call(arguments))}},CreateFuncWithOnlyThis:function(n){return function(){return n(this)}},CreateFuncWithThis:function(n){return function(){return n(this).apply(null,arguments)}},CreateFuncWithThisArgs:function(n){return function(){return n(this)(Array.prototype.slice.call(arguments))}},CreateFuncWithRest:function(n,t){return function(){return t(Array.prototype.slice.call(arguments,0,n).concat([Array.prototype.slice.call(arguments,n)]))}},CreateFuncWithArgsRest:function(n,t){return function(){return t([Array.prototype.slice.call(arguments,0,n),Array.prototype.slice.call(arguments,n)])}},BindDelegate:function(n,t){var i=n.bind(t);return i.$Func=n,i.$Target=t,i},CreateDelegate:function(n){if(n.length==0)return null;if(n.length==1)return n[0];var t=function(){for(var i,t=0;t<n.length;t++)i=n[t].apply(null,arguments);return i};return t.$Invokes=n,t},CombineDelegates:function(n){for(var t,i=[],r=0;r<n.length;r++)t=n[r],t&&("$Invokes"in t?i=i.concat(t.$Invokes):i.push(t));return IntelliFactory.Runtime.CreateDelegate(i)},DelegateEqual:function(n,t){var f,e,i,r,u;if(n===t)return!0;if(n==null||t==null||(f=n.$Invokes||[n],e=t.$Invokes||[t],f.length!=e.length))return!1;for(i=0;i<f.length;i++)if(r=f[i],u=e[i],!(r===u||"$Func"in r&&"$Func"in u&&r.$Func===u.$Func&&r.$Target==u.$Target))return!1;return!0},ThisFunc:function(n){return function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),n.apply(null,t)}},ThisFuncOut:function(n){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(t.shift(),t)}},ParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat([i.slice(n)]))}},ParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(null,i.slice(0,n).concat(i[n]))}},ThisParamsFunc:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this),t.apply(null,i.slice(0,n+1).concat([i.slice(n+1)]))}},ThisParamsFuncOut:function(n,t){return function(){var i=Array.prototype.slice.call(arguments);return t.apply(i.shift(),i.slice(0,n).concat(i[n]))}},Curried:function(n,t,i){return i=i||[],function(r){var u=i.concat([r===void 0?null:r]);return t==1?n.apply(null,u):t==2?function(t){return n.apply(null,u.concat([t===void 0?null:t]))}:IntelliFactory.Runtime.Curried(n,t-1,u)}},Curried2:function(n){return function(t){return function(i){return n(t,i)}}},Curried3:function(n){return function(t){return function(i){return function(r){return n(t,i,r)}}}},UnionByType:function(n,t,i){for(var u,f=typeof t,r=0;r<n.length;r++)if(u=n[r],typeof u=="number"){if(Array.isArray(t)&&(u==0||t.length==u))return{$:r,$0:t}}else if(u==f)return{$:r,$0:t};if(!i)throw new Error("Type not expected for creating Choice value.");},ScriptBasePath:"./",ScriptPath:function(n,t){return this.ScriptBasePath+(this.ScriptSkipAssemblyDir?"":n+"/")+t},OnLoad:function(n){"load"in this||(this.load=[]);this.load.push(n)},Start:function(){function n(n){for(var t=0;t<n.length;t++)n[t]()}"load"in this&&(n(this.load),this.load=[])}}};IntelliFactory.Runtime.OnLoad(function(){self.WebSharper&&WebSharper.Activator&&WebSharper.Activator.Activate&&WebSharper.Activator.Activate()});Date.now||(Date.now=function(){return(new Date).getTime()});Math.trunc||(Math.trunc=function(n){return n<0?Math.ceil(n):Math.floor(n)});Object.setPrototypeOf||(Object.setPrototypeOf=function(n,t){return n.__proto__=t,n});console||(console={count:ignore,dir:ignore,error:ignore,group:ignore,groupEnd:ignore,info:ignore,log:ignore,profile:ignore,profileEnd:ignore,time:ignore,timeEnd:ignore,trace:ignore,warn:ignore});
var JSON;JSON||(JSON={}),function(){"use strict";function i(n){return n<10?"0"+n:n}function f(n){return o.lastIndex=0,o.test(n)?'"'+n.replace(o,function(n){var t=s[n];return typeof t=="string"?t:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+n+'"'}function r(i,e){var s,l,h,a,v=n,c,o=e[i];o&&typeof o=="object"&&typeof o.toJSON=="function"&&(o=o.toJSON(i));typeof t=="function"&&(o=t.call(e,i,o));switch(typeof o){case"string":return f(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":return String(o);case"object":if(!o)return"null";if(n+=u,c=[],Object.prototype.toString.apply(o)==="[object Array]"){for(a=o.length,s=0;s<a;s+=1)c[s]=r(s,o)||"null";return h=c.length===0?"[]":n?"[\n"+n+c.join(",\n"+n)+"\n"+v+"]":"["+c.join(",")+"]",n=v,h}if(t&&typeof t=="object")for(a=t.length,s=0;s<a;s+=1)typeof t[s]=="string"&&(l=t[s],h=r(l,o),h&&c.push(f(l)+(n?": ":":")+h));else for(l in o)Object.prototype.hasOwnProperty.call(o,l)&&(h=r(l,o),h&&c.push(f(l)+(n?": ":":")+h));return h=c.length===0?"{}":n?"{\n"+n+c.join(",\n"+n)+"\n"+v+"}":"{"+c.join(",")+"}",n=v,h}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+i(this.getUTCMonth()+1)+"-"+i(this.getUTCDate())+"T"+i(this.getUTCHours())+":"+i(this.getUTCMinutes())+":"+i(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,n,u,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t;typeof JSON.stringify!="function"&&(JSON.stringify=function(i,f,e){var o;if(n="",u="",typeof e=="number")for(o=0;o<e;o+=1)u+=" ";else typeof e=="string"&&(u=e);if(t=f,f&&typeof f!="function"&&(typeof f!="object"||typeof f.length!="number"))throw new Error("JSON.stringify");return r("",{"":i})});typeof JSON.parse!="function"&&(JSON.parse=function(n,t){function r(n,i){var f,e,u=n[i];if(u&&typeof u=="object")for(f in u)Object.prototype.hasOwnProperty.call(u,f)&&(e=r(u,f),e!==undefined?u[f]=e:delete u[f]);return t.call(n,i,u)}var i;if(n=String(n),e.lastIndex=0,e.test(n)&&(n=n.replace(e,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return i=eval("("+n+")"),typeof t=="function"?r({"":i},""):i;throw new SyntaxError("JSON.parse");})}();
/* https://github.com/jonathantneal/closest */
(function(w,p){p=w.Element.prototype
if(!p.matches){p.matches=p.msMatchesSelector||function(s){var m=(this.document||this.ownerDocument).querySelectorAll(s);for(var i=0;m[i]&&m[i]!==e;++i);return!!m[i]}}
if(!p.closest){p.closest=function(s){var e=this;while(e&&e.nodeType==1){if(e.matches(s))return e;e=e.parentNode}return null}}})(this);
(function(){for(var i=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var t=(new Date).getTime(),r=Math.max(0,16-(t-i)),u=window.setTimeout(function(){n(t+r)},r);return i=t+r,u});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(n){clearTimeout(n)})})();
(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX;a=self;b=a.Client=a.Client||{};c=b.Client=b.Client||{};d=a.WebSharper=a.WebSharper||{};e=d.Unchecked=d.Unchecked||{};f=d.Obj=d.Obj||{};g=d.UI=d.UI||{};h=g.Var$1=g.Var$1||{};i=g.ListModel=g.ListModel||{};j=d.List=d.List||{};k=j.T=j.T||{};l=d.ClientSideJson=d.ClientSideJson||{};m=l.Provider=l.Provider||{};n=d.Operators=d.Operators||{};o=d.JavaScript=d.JavaScript||{};p=o.JS=o.JS||{};q=d.Utils=d.Utils||{};r=g.Var=g.Var||{};s=g.Templating=g.Templating||{};t=s.Runtime=s.Runtime||{};u=t.Server=t.Server||{};v=u.TemplateInstance=u.TemplateInstance||{};w=d.Arrays=d.Arrays||{};x=u.ProviderBuilder=u.ProviderBuilder||{};y=g.View=g.View||{};z=u.Handler=u.Handler||{};A=a.GeneratedPrintf=a.GeneratedPrintf||{};B=a.Client_Templates=a.Client_Templates||{};C=g.ConcreteVar=g.ConcreteVar||{};D=g.Snap=g.Snap||{};E=g.Storage=g.Storage||{};F=d.Seq=d.Seq||{};G=o.Pervasives=o.Pervasives||{};H=d.Concurrency=d.Concurrency||{};I=d.Strings=d.Strings||{};J=a.System=a.System||{};K=J.Guid=J.Guid||{};L=d.Collections=d.Collections||{};M=L.List=L.List||{};N=L.Dictionary=L.Dictionary||{};O=g.Client=g.Client||{};P=O.Templates=O.Templates||{};Q=g.Doc=g.Doc||{};R=g.Abbrev=g.Abbrev||{};S=R.Fresh=R.Fresh||{};T=E.ArrayStorage=E.ArrayStorage||{};U=H.AsyncBody=H.AsyncBody||{};V=a.StartupCode$WebSharper_Main$Concurrency=a.StartupCode$WebSharper_Main$Concurrency||{};W=H.CT=H.CT||{};X=a.Object;Y=g.AttrProxy=g.AttrProxy||{};Z=g.CheckedInput=g.CheckedInput||{};_0=d.Numeric=d.Numeric||{};_1=L.HashSet=L.HashSet||{};_2=u.TemplateInitializer=u.TemplateInitializer||{};_3=a.EventTarget;_4=a.Node;_5=d.Enumerator=d.Enumerator||{};_6=H.Scheduler=H.Scheduler||{};_7=d.CancellationTokenSource=d.CancellationTokenSource||{};_8=L.DictionaryUtil=L.DictionaryUtil||{};_9=_5.T=_5.T||{};_=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};$=a.WindowOrWorkerGlobalScope;ba=g.Docs=g.Docs||{};bb=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};bc=a.Error;bd=d.OperationCanceledException=d.OperationCanceledException||{};be=g.DocElemNode=g.DocElemNode||{};bf=a.CharacterData;bg=g.Elt=g.Elt||{};bh=P.Prepare=P.Prepare||{};bi=d.Slice=d.Slice||{};bj=g.DomUtility=g.DomUtility||{};bk=L.KeyCollection=L.KeyCollection||{};bl=g.An=g.An||{};bm=O.Settings=O.Settings||{};bn=R.Mailbox=R.Mailbox||{};bo=O.Attrs=O.Attrs||{};bp=bo.Dyn=bo.Dyn||{};bq=d.Queue=d.Queue||{};br=g.Array=g.Array||{};bs=g.Attrs=g.Attrs||{};bt=g.AttrModule=g.AttrModule||{};bu=g.Updates=g.Updates||{};bv=L.ValueCollection=L.ValueCollection||{};bw=O.Docs=O.Docs||{};bx=bw.RunState=bw.RunState||{};by=bw.NodeSet=bw.NodeSet||{};bz=g.Anims=g.Anims||{};bA=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bB=L.HashSetUtil=L.HashSetUtil||{};bC=g.BindVar=g.BindVar||{};bD=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};bE=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};bF=g.AppendList=g.AppendList||{};bG=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};bH=g.DynamicAttrNode=g.DynamicAttrNode||{};bI=g.Easing=g.Easing||{};bJ=R.HashSet=R.HashSet||{};bK=g.String=g.String||{};bL=bw.DomNodes=bw.DomNodes||{};bM=d.Char=d.Char||{};bN=d.Lazy=d.Lazy||{};bO=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};bP=d.LazyExtensionsProxy=d.LazyExtensionsProxy||{};bQ=bP.LazyRecord=bP.LazyRecord||{};bR=a.console;bS=a.JSON;bT=a.jQuery;bU=a.IntelliFactory;bV=bU&&bU.Runtime;bW=a.Math;bX=a.Date;c.Main=function(){var bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce;function cf(cm){var cn;(function(co){return co("Sending registration request to server");}(function(co){bR.log(co);}));cn=null;return H.Delay(function(){return H.Bind(c.Ajax("POST","http://localhost:5000/api/users",bS.stringify(((m.Id())())(cm))),function(co){bY=cm;return H.Return(((m.Id())())(bS.parse(co)));});});}function cg(cm){var cn;(function(co){return co("Sending login request to server");}(function(co){bR.log(co);}));cn=null;return H.Delay(function(){return H.Bind(c.Ajax("POST","http://localhost:5000/api/users/login",bS.stringify(((m.Id())())(cm))),function(co){bY=cm;return H.Return(((m.Id())())(bS.parse(co)));});});}function ch(cm){var cn;(function(co){return co("Sending subscription request to server");}(function(co){bR.log(co);}));H.Start((cn=null,H.Delay(function(){return H.Bind(c.Ajax("POST","http://localhost:5000/api/users/subscribe",bS.stringify(((m.Id())())(cm))),function(co){m.Id();bS.parse(co);return H.Return(null);});})),null);}function ci(cm){var cn;(function(co){return co("Sending tweet to server");}(function(co){bR.log(co);}));cn=null;return H.Delay(function(){return H.Bind(c.Ajax("POST","http://localhost:5000/api/tweets",bS.stringify(((m.Id())())(cm))),function(co){return H.Return(((m.Id())())(bS.parse(co)));});});}function cj(cm){var cn,co;(function(cp){return cp("Requesting feeds");}(function(cp){bR.log(cp);}));cn={qType:"subscription",qName:"",by:bY.username};co=null;return H.Delay(function(){return H.Bind(c.Ajax("POST","http://localhost:5000/api/tweets/search",bS.stringify(((m.Id())())(cn))),function(cp){return H.Return(((m.DecodeList(m.Id()))())(bS.parse(cp)));});});}function ck(cm){var cn;(function(co){return co("Sending query to server");}(function(co){bR.log(co);}));cn=null;return H.Delay(function(){return H.Bind(c.Ajax("POST","http://localhost:5000/api/tweets/search",bS.stringify(((m.Id())())(cm))),function(co){return H.Return(((m.DecodeList(m.Id()))())(bS.parse(co)));});});}function cl(cm){return I.Replace(I.Replace(cm,"{\"error\":\"",""),"\"}","");}bY=null;bZ=h.Create$1("");b0=i.Create(function(cm){return cm.id;},k.Empty);b1=i.Create(function(cm){return cm.id;},k.Empty);a.setInterval(function(){var cm,cn;if(!e.Equals(bY,null)){cm={qType:"subscription",qName:"",by:bY.username};H.Start((cn=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(cj(cm),function(co){j.iter(function(cp){b1.Append(cp);},co);return H.Zero();});}),function(co){((function(cp){return function(cq){return cp("Exception Caught: "+q.toSafe(cq));};}(function(cp){bR.log(cp);}))(co.message));bZ.Set(cl(co.message));return H.Zero();});})),null);}else bZ.Set("Please login first");},3000);a.setInterval(function(){var cm,cn;if(!e.Equals(bY,null)){cm={qType:"mention",qName:"@"+bY.username,by:bY.username};H.Start((cn=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(cj(cm),function(co){j.iter(function(cp){b1.Append(cp);},co);return H.Zero();});}),function(co){((function(cp){return function(cq){return cp("Exception Caught: "+q.toSafe(cq));};}(function(cp){bR.log(cp);}))(co.message));bZ.Set(cl(co.message));return H.Zero();});})),null);}else bZ.Set("Please login first");},3000);b2=(b3=(b4=Q.Convert(function(cm){var cn,co,cp,cq,cr,cs;cn={id:"",reId:cm.id,text:"",tType:"retweet",by:bY.username};return(co=(cp=(cq=new x.New$1(),(cq.h.push({$:1,$0:"text",$1:cm.text}),cq)),(cp.h.push(z.EventQ2(cp.k,"onretweet",function(){return cp.i;},function(){var ct;H.Start((ct=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(ci(cn),function(cu){bZ.Set("You retweeted");((function(cv){return function(cw){return cv("response="+A.p(cw));};}(function(cv){bR.log(cv);}))(cu));return H.Zero();});}),function(cu){((function(cv){return function(cw){return cv("Exception Caught: "+q.toSafe(cw));};}(function(cv){bR.log(cv);}))(cu.message));bZ.Set("Your tweet wasn't posted");return H.Zero();});})),null);})),cp)),(cr=z.CompleteHoles(co.k,co.h,[]),(cs=new v.New(cr[1],B.tweet(cr[0])),co.i=cs,cs))).get_Doc();},b1.v),(b5=(b6=Q.Convert(function(cm){var cn,co,cp,cq,cr,cs;cn={id:"",reId:cm.id,text:"",tType:"retweet",by:bY.username};return(co=(cp=(cq=new x.New$1(),(cq.h.push({$:1,$0:"text",$1:cm.text}),cq)),(cp.h.push(z.EventQ2(cp.k,"onretweet",function(){return cp.i;},function(){var ct;H.Start((ct=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(ci(cn),function(cu){bZ.Set("You retweeted");((function(cv){return function(cw){return cv("response="+A.p(cw));};}(function(cv){bR.log(cv);}))(cu));return H.Zero();});}),function(cu){((function(cv){return function(cw){return cv("Exception Caught: "+q.toSafe(cw));};}(function(cv){bR.log(cv);}))(cu.message));bZ.Set("Your tweet wasn't posted");return H.Zero();});})),null);})),cp)),(cr=z.CompleteHoles(co.k,co.h,[]),(cs=new v.New(cr[1],B.tweet(cr[0])),co.i=cs,cs))).get_Doc();},b0.v),(b7=(b8=(b9=(b_=(b$=(ca=(cb=y.Map(a.id,bZ.get_View()),(cc=new x.New$1(),(cc.h.push({$:2,$0:"info",$1:cb}),cc))),(ca.h.push(z.EventQ2(ca.k,"onregister",function(){return ca.i;},function(cm){var cn,co;if(cm.Vars.Hole("regusername").$1.Get()===""||cm.Vars.Hole("regpassword").$1.Get()===""||cm.Vars.Hole("regconfirmpassword").$1.Get()==="")bZ.Set("Fields cannot be left empty");else if(cm.Vars.Hole("regpassword").$1.Get()!==cm.Vars.Hole("regconfirmpassword").$1.Get())bZ.Set("Passwords don't match");else{cn={id:0,username:cm.Vars.Hole("regusername").$1.Get(),password:cm.Vars.Hole("regpassword").$1.Get()};H.Start((co=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(cf(cn),function(cp){bZ.Set("Your account was created");((function(cq){return function(cr){return cq("response="+A.p(cr));};}(function(cq){bR.log(cq);}))(cp));return H.Zero();});}),function(cp){((function(cq){return function(cr){return cq("Exception Caught: "+q.toSafe(cr));};}(function(cq){bR.log(cq);}))(cp.message));bZ.Set(cl(cp.message));return H.Zero();});})),null);cm.Vars.Hole("regusername").$1.Set("");cm.Vars.Hole("regpassword").$1.Set("");cm.Vars.Hole("regconfirmpassword").$1.Set("");}})),ca)),(b$.h.push(z.EventQ2(b$.k,"onlogin",function(){return b$.i;},function(cm){var cn,co;if(cm.Vars.Hole("logusername").$1.Get()===""||cm.Vars.Hole("logpassword").$1.Get()==="")bZ.Set("Fields cannot be left empty");else{cn={id:0,username:cm.Vars.Hole("logusername").$1.Get(),password:cm.Vars.Hole("logpassword").$1.Get()};H.Start((co=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(cg(cn),function(cp){bZ.Set("Hi "+cn.username+"!");((function(cq){return function(cr){return cq("response="+A.p(cr));};}(function(cq){bR.log(cq);}))(cp));return H.Zero();});}),function(cp){((function(cq){return function(cr){return cq("Exception Caught: "+q.toSafe(cr));};}(function(cq){bR.log(cq);}))(cp.message));bZ.Set(cl(cp.message));return H.Zero();});})),null);cm.Vars.Hole("logusername").$1.Set("");cm.Vars.Hole("logpassword").$1.Set("");}})),b$)),(b_.h.push(z.EventQ2(b_.k,"onsubscribe",function(){return b_.i;},function(cm){ch({publisher:cm.Vars.Hole("publisher").$1.Get(),subscriber:bY.username});})),b_)),(b9.h.push(z.EventQ2(b9.k,"ontweet",function(){return b9.i;},function(cm){var cn,co;if(e.Equals(bY,null))bZ.Set("Please login/register to tweet");else if(cm.Vars.Hole("tweettext").$1.Get()==="")bZ.Set("You cannot post empty tweet");else{cn={id:"",reId:"",text:cm.Vars.Hole("tweettext").$1.Get(),tType:"tweet",by:bY.username};H.Start((co=null,H.Delay(function(){return H.TryWith(H.Delay(function(){return H.Bind(ci(cn),function(cp){bZ.Set("Your tweet was posted");((function(cq){return function(cr){return cq("response="+A.p(cr));};}(function(cq){bR.log(cq);}))(cp));return H.Zero();});}),function(cp){((function(cq){return function(cr){return cq("Exception Caught: "+q.toSafe(cr));};}(function(cq){bR.log(cq);}))(cp.message));bZ.Set("Your tweet wasn't posted");return H.Zero();});})),null);cm.Vars.Hole("tweettext").$1.Set("");}})),b9)),(b8.h.push(z.EventQ2(b8.k,"onsearch",function(){return b8.i;},function(cm){var cn,co,cp;b0.Clear();cn=cm.Vars.Hole("queryname").$1.Get();co=cn===""?{qType:"subscription",qName:cn,by:bY.username}:I.StartsWith(cn,"#")?{qType:"hashtag",qName:cn,by:bY.username}:{qType:"mention",qName:cn,by:bY.username};H.Start((cp=null,H.Delay(function(){return H.Bind(ck(co),function(cq){j.iter(function(cr){b0.Append(cr);},cq);return H.Zero();});})),null);})),b8)),(b7.h.push({$:0,$0:"queryresults",$1:b6}),b7))),(b5.h.push({$:0,$0:"feeds",$1:b4}),b5))),(cd=z.CompleteHoles(b3.k,b3.h,[["regusername",0],["regpassword",0],["regconfirmpassword",0],["logusername",0],["logpassword",0],["publisher",0],["tweettext",0],["queryname",0]]),(ce=new v.New(cd[1],B.main(cd[0])),b3.i=ce,ce))).get_Doc();P.LoadLocalTemplates("");Q.RunById("main",b2);};c.Ajax=function(bY,bZ,b0){function b1(b2,b3){var b4;bT.ajax((b4={},b4.url=bZ,b4.type=bY,b4.contentType="application/json",b4.dataType="text",b4.data=b0,b4.success=function(b5){return b2(b5);},b4.error=function(b5){return b3(new bc(b5.responseText));},b4));}return H.FromContinuations(function(b2,b3,b4){return b1.apply(null,[b2,b3,b4]);});};e.Equals=function(bY,bZ){var b0,b1,b2,b3;if(bY===bZ)return true;else{b0=typeof bY;if(b0=="object"){if(bY===null||bY===void 0||bZ===null||bZ===void 0)return false;else if("Equals"in bY)return bY.Equals(bZ);else if(bY instanceof a.Array&&bZ instanceof a.Array)return e.arrayEquals(bY,bZ);else if(bY instanceof a.Date&&bZ instanceof a.Date)return e.dateEquals(bY,bZ);else{b1=[true];for(var b4 in bY)if(function(b5){b1[0]=!bY.hasOwnProperty(b5)||bZ.hasOwnProperty(b5)&&e.Equals(bY[b5],bZ[b5]);return!b1[0];}(b4))break;if(b1[0]){for(var b5 in bZ)if(function(b6){b1[0]=!bZ.hasOwnProperty(b6)||bY.hasOwnProperty(b6);return!b1[0];}(b5))break;}return b1[0];}}else return b0=="function"&&("$Func"in bY?bY.$Func===bZ.$Func&&bY.$Target===bZ.$Target:"$Invokes"in bY&&"$Invokes"in bZ&&e.arrayEquals(bY.$Invokes,bZ.$Invokes));}};e.arrayEquals=function(bY,bZ){var b0,b1;if(w.length(bY)===w.length(bZ)){b0=true;b1=0;while(b0&&b1<w.length(bY)){!e.Equals(w.get(bY,b1),w.get(bZ,b1))?b0=false:void 0;b1=b1+1;}return b0;}else return false;};e.dateEquals=function(bY,bZ){return bY.getTime()===bZ.getTime();};e.Hash=function(bY){var bZ;bZ=typeof bY;return bZ=="function"?0:bZ=="boolean"?bY?1:0:bZ=="number"?bY:bZ=="string"?e.hashString(bY):bZ=="object"?bY==null?0:bY instanceof a.Array?e.hashArray(bY):e.hashObject(bY):0;};e.hashString=function(bY){var bZ,b0,b1;if(bY===null)return 0;else{bZ=5381;for(b0=0,b1=bY.length-1;b0<=b1;b0++)bZ=e.hashMix(bZ,bY[b0].charCodeAt());return bZ;}};e.hashArray=function(bY){var bZ,b0,b1;bZ=-34948909;for(b0=0,b1=w.length(bY)-1;b0<=b1;b0++)bZ=e.hashMix(bZ,e.Hash(w.get(bY,b0)));return bZ;};e.hashObject=function(bY){var bZ,b0;if("GetHashCode"in bY)return bY.GetHashCode();else{bZ=[0];for(var b1 in bY)if(function(b2){bZ[0]=e.hashMix(e.hashMix(bZ[0],e.hashString(b2)),e.Hash(bY[b2]));return false;}(b1))break;return bZ[0];}};e.hashMix=function(bY,bZ){return(bY<<5)+bY+bZ;};e.Compare=function(bY,bZ){var b0,b1,b2,b3,b4,b5;if(bY===bZ)return 0;else{b1=typeof bY;switch(b1=="function"?1:b1=="boolean"?2:b1=="number"?2:b1=="string"?2:b1=="object"?3:0){case 0:return typeof bZ=="undefined"?0:-1;case 1:return n.FailWith("Cannot compare function values.");case 2:return bY<bZ?-1:1;case 3:if(bY===null)b2=-1;else if(bZ===null)b2=1;else if("CompareTo"in bY)b2=bY.CompareTo(bZ);else if("CompareTo0"in bY)b2=bY.CompareTo0(bZ);else if(bY instanceof a.Array&&bZ instanceof a.Array)b2=e.compareArrays(bY,bZ);else if(bY instanceof a.Date&&bZ instanceof a.Date)b2=e.compareDates(bY,bZ);else{b3=[0];for(var b6 in bY)if(function(b7){return!bY.hasOwnProperty(b7)?false:!bZ.hasOwnProperty(b7)?(b3[0]=1,true):(b3[0]=e.Compare(bY[b7],bZ[b7]),b3[0]!==0);}(b6))break;if(b3[0]===0){for(var b7 in bZ)if(function(b8){return!bZ.hasOwnProperty(b8)?false:!bY.hasOwnProperty(b8)&&(b3[0]=-1,true);}(b7))break;}b2=b3[0];}return b2;}}};e.compareArrays=function(bY,bZ){var b0,b1;if(w.length(bY)<w.length(bZ))return -1;else if(w.length(bY)>w.length(bZ))return 1;else{b0=0;b1=0;while(b0===0&&b1<w.length(bY)){b0=e.Compare(w.get(bY,b1),w.get(bZ,b1));b1=b1+1;}return b0;}};e.compareDates=function(bY,bZ){return e.Compare(bY.getTime(),bZ.getTime());};f=d.Obj=bV.Class({Equals:function(bY){return this===bY;},GetHashCode:function(){return -1;}},null,f);f.New=bV.Ctor(function(){},f);h=g.Var$1=bV.Class({},f,h);h.Create$1=function(bY){return new C.New(false,D.New({$:2,$0:bY,$1:[]}),bY);};i.Create=function(bY,bZ){return i.CreateWithStorage(bY,E.InMemory(w.ofSeq(bZ)));};i.CreateWithStorage=function(bY,bZ){return new i.New(bY,bZ);};k=j.T=bV.Class({GetEnumerator:function(){return new _9.New(this,null,function(bY){var bZ;bZ=bY.s;return bZ.$==0?false:(bY.c=bZ.$0,bY.s=bZ.$1,true);},void 0);},GetEnumerator0:function(){return _5.Get(this);}},null,k);k.Empty=new k({$:0});i=g.ListModel=bV.Class({Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},Append:function(bY){var bZ,b0,b1,b2;bZ=this;b0=this["var"].Get();b1=this.key(bY);b2=w.tryFindIndex(function(b3){return e.Equals(bZ.key(b3),b1);},b0);b2!=null&&b2.$==1?this["var"].Set(this.storage.SSetAt(b2.$0,bY,b0)):this["var"].Set(this.storage.SAppend(bY,b0));this.ObsoleteKey(b1);},ObsoleteAll:function(){F.iter(function(bY){D.Obsolete(bY.V);},this.it);this.it.Clear();},ObsoleteKey:function(bY){var bZ,b0;bZ=(b0=null,[this.it.TryGetValue(bY,{get:function(){return b0;},set:function(b1){b0=b1;}}),b0]);bZ[0]?(D.Obsolete(bZ[1]),this.it.Remove(bY)):void 0;},GetEnumerator:function(){return _5.Get(this["var"].Get());},GetEnumerator0:function(){return _5.Get0(this["var"].Get());}},f,i);i.New=bV.Ctor(function(bY,bZ){i.New$3.call(this,bY,h.Create$1(w.ofSeq(F.distinctBy(bY,bZ.SInit()))),bZ);},i);i.New$3=bV.Ctor(function(bY,bZ,b0){f.New.call(this);this.key=bY;this["var"]=bZ;this.storage=b0;this.v=y.Map(function(b1){return b1.slice();},this["var"].get_View());this.it=new N.New$5();},i);m.Id=bV.Curried3(function(bY,bZ,b0){return b0;});m.DecodeList=bV.Curried3(function(bY,bZ,b0){var b1;b1=bY();return j.init(w.length(b0),function(b2){return b1(w.get(b0,b2));});});n.FailWith=function(bY){throw new bc(bY);};n.KeyValue=function(bY){return[bY.K,bY.V];};p.GetFields=function(bY){var bZ,b0;bZ=[];for(var b1 in bY)bZ.push([b1,bY[b1]]);return bZ;};p.GetFieldValues=function(bY){var bZ,b0;bZ=[];for(var b1 in bY)bZ.push(bY[b1]);return bZ;};j.iter=function(bY,bZ){var b0;b0=bZ;while(b0.$==1){bY(j.head(b0));b0=j.tail(b0);}};j.init=function(bY,bZ){return j.ofArray(w.init(bY,bZ));};j.ofArray=function(bY){var bZ,b0,b1;bZ=k.Empty;for(b0=w.length(bY)-1,b1=0;b0>=b1;b0--)bZ=new k({$:1,$0:w.get(bY,b0),$1:bZ});return bZ;};j.head=function(bY){return bY.$==1?bY.$0:j.listEmpty();};j.tail=function(bY){return bY.$==1?bY.$1:j.listEmpty();};j.listEmpty=function(){return n.FailWith("The input list was empty.");};q.toSafe=function(bY){return bY==null?"":bY;};q.prettyPrint=function(bY){var bZ,b0;function b1(b2,b3){return b2+" = "+q.prettyPrint(b3);}return bY===null?"null":(bZ=typeof bY,bZ=="string"?"\""+bY+"\"":bZ=="object"?bY instanceof a.Array?"[|"+I.concat("; ",w.map(q.prettyPrint,bY))+"|]":(b0=a.String(bY),b0==="[object Object]"?"{"+I.concat("; ",w.map(function(b2){return b1(b2[0],b2[1]);},p.GetFields(bY)))+"}":b0):a.String(bY));};r=g.Var=bV.Class({},f,r);r.New=bV.Ctor(function(){f.New.call(this);},r);v=u.TemplateInstance=bV.Class({get_Doc:function(){return this.doc;},Hole:function(bY){return this.allVars.get_Item(bY);}},f,v);v.New=bV.Ctor(function(bY,bZ){f.New.call(this);this.doc=bZ;this.allVars=bY.$==0?bY.$0:n.FailWith("Should not happen");},v);w.get=function(bY,bZ){w.checkBounds(bY,bZ);return bY[bZ];};w.length=function(bY){return bY.dims===2?bY.length*bY.length:bY.length;};w.checkBounds=function(bY,bZ){if(bZ<0||bZ>=bY.length)n.FailWith("Index was outside the bounds of the array.");};w.set=function(bY,bZ,b0){w.checkBounds(bY,bZ);bY[bZ]=b0;};x=u.ProviderBuilder=bV.Class({},f,x);x.New$1=bV.Ctor(function(){var bY;f.New.call(this);this.i=null;this.k=(bY=K.NewGuid(),a.String(bY));this.h=[];bV.SetOptional(this,"s",null);},x);y.Map=function(bY,bZ){return y.CreateLazy(function(){return D.Map(bY,bZ());});};y.CreateLazy=function(bY){var bZ;bZ={c:null,o:bY};return function(){var b0,b1;b0=bZ.c;return b0===null?(b0=bZ.o(),bZ.c=b0,(b1=b0.s,b1!=null&&b1.$==0)?bZ.o=null:D.WhenObsoleteRun(b0,function(){bZ.c=null;}),b0):b0;};};y.MapSeqCached=function(bY,bZ){return y.MapSeqCachedBy(a.id,bY,bZ);};y.MapSeqCachedBy=function(bY,bZ,b0){var b1;b1=[new N.New$5()];return y.Map(function(b2){var b3,b4,b5;b3=b1[0];b4=new N.New$5();b5=br.mapInPlace(function(b6){var b7,b8;b7=bY(b6);b8=b3.ContainsKey(b7)?b3.get_Item(b7):bZ(b6);b4.set_Item(b7,b8);return b8;},w.ofSeq(b2));b1[0]=b4;return b5;},b0);};y.Const=function(bY){var bZ;bZ=D.New({$:0,$0:bY});return function(){return bZ;};};y.Sink=function(bY,bZ){function b0(){D.WhenRun(bZ(),bY,function(){H.scheduler().Fork(b0);});}H.scheduler().Fork(b0);};y.Bind=function(bY,bZ){return y.Join(y.Map(bY,bZ));};y.Map3=function(bY,bZ,b0,b1){return y.CreateLazy(function(){return D.Map3(bY,bZ(),b0(),b1());});};y.Sequence=function(bY){return y.CreateLazy(function(){return D.Sequence(F.map(function(bZ){return bZ();},bY));});};y.Map2=function(bY,bZ,b0){return y.CreateLazy(function(){return D.Map2(bY,bZ(),b0());});};y.Map2Unit=function(bY,bZ){return y.CreateLazy(function(){return D.Map2Unit(bY(),bZ());});};y.Join=function(bY){return y.CreateLazy(function(){return D.Join(bY());});};z.EventQ2=function(bY,bZ,b0,b1){return{$:5,$0:bZ,$1:function(b2){return function(b3){return b1({Vars:b0(),Target:b2,Event:b3});};}};};z.CompleteHoles=function(bY,bZ,b0){var b2,b3,b4,b5,b6;function b1(b7,b8){var b9;return b3.Contains(b7)?null:(b9=b8===0?_2.GetOrAddHoleFor(bY,b7,function(){return{$:8,$0:b7,$1:h.Create$1("")};}):b8===1?_2.GetOrAddHoleFor(bY,b7,function(){return{$:13,$0:b7,$1:h.Create$1(0)};}):b8===2?_2.GetOrAddHoleFor(bY,b7,function(){return{$:9,$0:b7,$1:h.Create$1(false)};}):n.FailWith("Invalid value type"),(b2.set_Item(b7,b9),{$:1,$0:b9}));}b2=new N.New$5();b3=new _1.New$3();b4=_5.Get(bZ);try{while(b4.MoveNext()){b5=b4.Current();b6=b5.$0;b3.Add(b6);b2.set_Item(b6,b5);}}finally{if(typeof b4=="object"&&"Dispose"in b4)b4.Dispose();}return[F.append(bZ,w.choose(function(b7){return b1(b7[0],b7[1]);},b0)),{$:0,$0:b2}];};A.p=function(bY){return"{"+("id = "+q.prettyPrint(bY.id))+"}";};B.tweet=function(bY){P.LoadLocalTemplates("index");return bY?P.NamedTemplate("index",{$:1,$0:"tweet"},bY):void 0;};B.main=function(bY){P.LoadLocalTemplates("index");return bY?P.NamedTemplate("index",{$:1,$0:"main"},bY):void 0;};C=g.ConcreteVar=bV.Class({get_View:function(){return this.view;},Set:function(bY){if(this.isConst)(function(bZ){return bZ("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bZ){bR.log(bZ);}));else{D.Obsolete(this.snap);this.current=bY;this.snap=D.New({$:2,$0:bY,$1:[]});}},Get:function(){return this.current;},UpdateMaybe:function(bY){var bZ;bZ=bY(this.Get());bZ!=null&&bZ.$==1?this.Set(bZ.$0):void 0;}},r,C);C.New=bV.Ctor(function(bY,bZ,b0){var b1;b1=this;r.New.call(this);this.isConst=bY;this.current=b0;this.snap=bZ;this.view=function(){return b1.snap;};this.id=S.Int();},C);D.Map=function(bY,bZ){var b0,b1;b0=bZ.s;return b0!=null&&b0.$==0?D.New({$:0,$0:bY(b0.$0)}):(b1=D.New({$:3,$0:[],$1:[]}),(D.When(bZ,function(b2){D.MarkDone(b1,bZ,bY(b2));},b1),b1));};D.WhenObsoleteRun=function(bY,bZ){var b0;b0=bY.s;b0==null?bZ():b0!=null&&b0.$==2?b0.$1.push(bZ):b0!=null&&b0.$==3?b0.$1.push(bZ):void 0;};D.When=function(bY,bZ,b0){var b1;b1=bY.s;b1==null?D.Obsolete(b0):b1!=null&&b1.$==2?(D.EnqueueSafe(b1.$1,b0),bZ(b1.$0)):b1!=null&&b1.$==3?(b1.$0.push(bZ),D.EnqueueSafe(b1.$1,b0)):bZ(b1.$0);};D.MarkDone=function(bY,bZ,b0){var b1;if(b1=bZ.s,b1!=null&&b1.$==0)D.MarkForever(bY,b0);else D.MarkReady(bY,b0);};D.EnqueueSafe=function(bY,bZ){var b0,b1,b2,b3;bY.push(bZ);if(bY.length%20===0){b0=bY.slice(0);bq.Clear(bY);for(b1=0,b2=w.length(b0)-1;b1<=b2;b1++){b3=w.get(b0,b1);typeof b3=="object"?function(b4){if(b4.s)bY.push(b4);}(b3):function(b4){bY.push(b4);}(b3);}}else void 0;};D.MarkForever=function(bY,bZ){var b0,b1,b2,b3;b0=bY.s;if(b0!=null&&b0.$==3){bY.s={$:0,$0:bZ};b1=b0.$0;for(b2=0,b3=w.length(b1)-1;b2<=b3;b2++)(w.get(b1,b2))(bZ);}else void 0;};D.MarkReady=function(bY,bZ){var b0,b1,b2,b3;b0=bY.s;if(b0!=null&&b0.$==3){bY.s={$:2,$0:bZ,$1:b0.$1};b1=b0.$0;for(b2=0,b3=w.length(b1)-1;b2<=b3;b2++)(w.get(b1,b2))(bZ);}else void 0;};D.WhenRun=function(bY,bZ,b0){var b1;b1=bY.s;b1==null?b0():b1!=null&&b1.$==2?(b1.$1.push(b0),bZ(b1.$0)):b1!=null&&b1.$==3?(b1.$0.push(bZ),b1.$1.push(b0)):bZ(b1.$0);};D.Map3=function(bY,bZ,b0,b1){var b2,b3,b4,b5;function b6(b7){var b8,b9,b_,b$;if(!(b8=b5.s,b8!=null&&b8.$==0||b8!=null&&b8.$==2)){b9=D.ValueAndForever(bZ);b_=D.ValueAndForever(b0);b$=D.ValueAndForever(b1);b9!=null&&b9.$==1?b_!=null&&b_.$==1?b$!=null&&b$.$==1?b9.$0[1]&&b_.$0[1]&&b$.$0[1]?D.MarkForever(b5,bY(b9.$0[0],b_.$0[0],b$.$0[0])):D.MarkReady(b5,bY(b9.$0[0],b_.$0[0],b$.$0[0])):void 0:void 0:void 0;}}b2=bZ.s;b3=b0.s;b4=b1.s;return b2!=null&&b2.$==0?b3!=null&&b3.$==0?b4!=null&&b4.$==0?D.New({$:0,$0:bY(b2.$0,b3.$0,b4.$0)}):D.Map3Opt1(bY,b2.$0,b3.$0,b1):b4!=null&&b4.$==0?D.Map3Opt2(bY,b2.$0,b4.$0,b0):D.Map3Opt3(bY,b2.$0,b0,b1):b3!=null&&b3.$==0?b4!=null&&b4.$==0?D.Map3Opt4(bY,b3.$0,b4.$0,bZ):D.Map3Opt5(bY,b3.$0,bZ,b1):b4!=null&&b4.$==0?D.Map3Opt6(bY,b4.$0,bZ,b0):(b5=D.New({$:3,$0:[],$1:[]}),(D.When(bZ,b6,b5),D.When(b0,b6,b5),D.When(b1,b6,b5),b5));};D.Sequence=function(bY){var bZ,b0,b1;function b2(b3){var b4;if(b1[0]===0){b4=w.map(function(b5){var b6;b6=b5.s;return b6!=null&&b6.$==0?b6.$0:b6!=null&&b6.$==2?b6.$0:n.FailWith("value not found by View.Sequence");},bZ);w.forall(function(b5){var b6;b6=b5.s;return b6!=null&&b6.$==0;},bZ)?D.MarkForever(b0,b4):D.MarkReady(b0,b4);}else b1[0]--;}bZ=w.ofSeq(bY);return bZ.length==0?D.New({$:0,$0:[]}):(b0=D.New({$:3,$0:[],$1:[]}),(b1=[w.length(bZ)-1],(w.iter(function(b3){D.When(b3,b2,b0);},bZ),b0)));};D.Map2=function(bY,bZ,b0){var b1,b2,b3;function b4(b5){var b6,b7,b8;if(!(b6=b3.s,b6!=null&&b6.$==0||b6!=null&&b6.$==2)){b7=D.ValueAndForever(bZ);b8=D.ValueAndForever(b0);b7!=null&&b7.$==1?b8!=null&&b8.$==1?b7.$0[1]&&b8.$0[1]?D.MarkForever(b3,bY(b7.$0[0],b8.$0[0])):D.MarkReady(b3,bY(b7.$0[0],b8.$0[0])):void 0:void 0;}}b1=bZ.s;b2=b0.s;return b1!=null&&b1.$==0?b2!=null&&b2.$==0?D.New({$:0,$0:bY(b1.$0,b2.$0)}):D.Map2Opt1(bY,b1.$0,b0):b2!=null&&b2.$==0?D.Map2Opt2(bY,b2.$0,bZ):(b3=D.New({$:3,$0:[],$1:[]}),(D.When(bZ,b4,b3),D.When(b0,b4,b3),b3));};D.Map2Unit=function(bY,bZ){var b0,b1,b2;function b3(){var b4,b5,b6;if(!(b4=b2.s,b4!=null&&b4.$==0||b4!=null&&b4.$==2)){b5=D.ValueAndForever(bY);b6=D.ValueAndForever(bZ);b5!=null&&b5.$==1?b6!=null&&b6.$==1?b5.$0[1]&&b6.$0[1]?D.MarkForever(b2,null):D.MarkReady(b2,null):void 0:void 0;}}b0=bY.s;b1=bZ.s;return b0!=null&&b0.$==0?b1!=null&&b1.$==0?D.New({$:0,$0:null}):bZ:b1!=null&&b1.$==0?bY:(b2=D.New({$:3,$0:[],$1:[]}),(D.When(bY,b3,b2),D.When(bZ,b3,b2),b2));};D.Copy=function(bY){var bZ,b0,b1;bZ=bY.s;return bZ==null?bY:bZ!=null&&bZ.$==2?(b0=D.New({$:2,$0:bZ.$0,$1:[]}),(D.WhenObsolete(bY,b0),b0)):bZ!=null&&bZ.$==3?(b1=D.New({$:3,$0:[],$1:[]}),(D.When(bY,function(b2){D.MarkDone(b1,bY,b2);},b1),b1)):bY;};D.Join=function(bY){var bZ;bZ=D.New({$:3,$0:[],$1:[]});D.When(bY,function(b0){var b1;b1=b0();D.When(b1,function(b2){var b3,b4;if((b3=b1.s,b3!=null&&b3.$==0)&&(b4=bY.s,b4!=null&&b4.$==0))D.MarkForever(bZ,b2);else D.MarkReady(bZ,b2);},bZ);},bZ);return bZ;};D.Map3Opt1=function(bY,bZ,b0,b1){return D.Map(function(b2){return bY(bZ,b0,b2);},b1);};D.Map3Opt2=function(bY,bZ,b0,b1){return D.Map(function(b2){return bY(bZ,b2,b0);},b1);};D.Map3Opt3=function(bY,bZ,b0,b1){return D.Map2(function(b2,b3){return bY(bZ,b2,b3);},b0,b1);};D.Map3Opt4=function(bY,bZ,b0,b1){return D.Map(function(b2){return bY(b2,bZ,b0);},b1);};D.Map3Opt5=function(bY,bZ,b0,b1){return D.Map2(function(b2,b3){return bY(b2,bZ,b3);},b0,b1);};D.Map3Opt6=function(bY,bZ,b0,b1){return D.Map2(function(b2,b3){return bY(b2,b3,bZ);},b0,b1);};D.ValueAndForever=function(bY){var bZ;bZ=bY.s;return bZ!=null&&bZ.$==0?{$:1,$0:[bZ.$0,true]}:bZ!=null&&bZ.$==2?{$:1,$0:[bZ.$0,false]}:null;};D.Map2Opt1=function(bY,bZ,b0){return D.Map(function(b1){return bY(bZ,b1);},b0);};D.Map2Opt2=function(bY,bZ,b0){return D.Map(function(b1){return bY(b1,bZ);},b0);};D.WhenObsolete=function(bY,bZ){var b0;b0=bY.s;b0==null?D.Obsolete(bZ):b0!=null&&b0.$==2?D.EnqueueSafe(b0.$1,bZ):b0!=null&&b0.$==3?D.EnqueueSafe(b0.$1,bZ):void 0;};E.InMemory=function(bY){return new T.New(bY);};F.iter=function(bY,bZ){var b0;b0=_5.Get(bZ);try{while(b0.MoveNext())bY(b0.Current());}finally{if(typeof b0=="object"&&"Dispose"in b0)b0.Dispose();}};F.append=function(bY,bZ){return{GetEnumerator:function(){var b0,b1;b0=_5.Get(bY);b1=[true];return new _9.New(b0,null,function(b2){var b3;return b2.s.MoveNext()?(b2.c=b2.s.Current(),true):(b3=b2.s,!e.Equals(b3,null)?b3.Dispose():void 0,b2.s=null,b1[0]&&(b1[0]=false,b2.s=_5.Get(bZ),b2.s.MoveNext()?(b2.c=b2.s.Current(),true):(b2.s.Dispose(),b2.s=null,false)));},function(b2){var b3;b3=b2.s;!e.Equals(b3,null)?b3.Dispose():void 0;});}};};F.distinctBy=function(bY,bZ){return{GetEnumerator:function(){var b0,b1;b0=_5.Get(bZ);b1=new _1.New$3();return new _9.New(null,null,function(b2){var b3,b4;if(b0.MoveNext()){b3=b0.Current();b4=b1.Add(bY(b3));while(!b4&&b0.MoveNext()){b3=b0.Current();b4=b1.Add(bY(b3));}return b4&&(b2.c=b3,true);}else return false;},function(){b0.Dispose();});}};};F.head=function(bY){var bZ;bZ=_5.Get(bY);try{return bZ.MoveNext()?bZ.Current():F.insufficient();}finally{if(typeof bZ=="object"&&"Dispose"in bZ)bZ.Dispose();}};F.fold=function(bY,bZ,b0){var b1,b2;b1=bZ;b2=_5.Get(b0);try{while(b2.MoveNext())b1=bY(b1,b2.Current());return b1;}finally{if(typeof b2=="object"&&"Dispose"in b2)b2.Dispose();}};F.map=function(bY,bZ){return{GetEnumerator:function(){var b0;b0=_5.Get(bZ);return new _9.New(null,null,function(b1){return b0.MoveNext()&&(b1.c=bY(b0.Current()),true);},function(){b0.Dispose();});}};};F.max=function(bY){var bZ,b0,b1;bZ=_5.Get(bY);try{if(!bZ.MoveNext())F.seqEmpty();b0=bZ.Current();while(bZ.MoveNext()){b1=bZ.Current();e.Compare(b1,b0)===1?b0=b1:void 0;}return b0;}finally{if(typeof bZ=="object"&&"Dispose"in bZ)bZ.Dispose();}};F.seqEmpty=function(){return n.FailWith("The input sequence was empty.");};F.forall=function(bY,bZ){return!F.exists(function(b0){return!bY(b0);},bZ);};F.exists=function(bY,bZ){var b0,b1;b0=_5.Get(bZ);try{b1=false;while(!b1&&b0.MoveNext())b1=bY(b0.Current());return b1;}finally{if(typeof b0=="object"&&"Dispose"in b0)b0.Dispose();}};G.NewFromSeq=function(bY){var bZ,b0,b1;bZ={};b0=_5.Get(bY);try{while(b0.MoveNext()){b1=b0.Current();bZ[b1[0]]=b1[1];}}finally{if(typeof b0=="object"&&"Dispose"in b0)b0.Dispose();}return bZ;};H.Delay=function(bY){return function(bZ){try{(bY(null))(bZ);}catch(b0){bZ.k({$:1,$0:b0});}};};H.Bind=function(bY,bZ){return H.checkCancel(function(b0){bY(U.New(function(b1){var b2;if(b1.$==0){b2=b1.$0;H.scheduler().Fork(function(){try{(bZ(b2))(b0);}catch(b3){b0.k({$:1,$0:b3});}});}else H.scheduler().Fork(function(){b0.k(b1);});},b0.ct));});};H.Return=function(bY){return function(bZ){bZ.k({$:0,$0:bY});};};H.TryWith=function(bY,bZ){return function(b0){bY(U.New(function(b1){if(b1.$==0)b0.k({$:0,$0:b1.$0});else if(b1.$==1)try{(bZ(b1.$0))(b0);}catch(b2){b0.k(b1);}else b0.k(b1);},b0.ct));};};H.Zero=function(){V.$cctor();return V.Zero;};H.Start=function(bY,bZ){var b0,b1;b0=(b1=(H.defCTS())[0],bZ==null?b1:bZ.$0);H.scheduler().Fork(function(){if(!b0.c)bY(U.New(function(b2){if(b2.$==1)H.UncaughtAsyncError(b2.$0);},b0));});};H.checkCancel=function(bY){return function(bZ){if(bZ.ct.c)H.cancel(bZ);else bY(bZ);};};H.FromContinuations=function(bY){return function(bZ){var b0;function b1(b2){if(b0[0])n.FailWith("A continuation provided by Async.FromContinuations was invoked multiple times");else{b0[0]=true;H.scheduler().Fork(b2);}}b0=[false];bY(function(b2){b1(function(){bZ.k({$:0,$0:b2});});},function(b2){b1(function(){bZ.k({$:1,$0:b2});});},function(b2){b1(function(){bZ.k({$:2,$0:b2});});});};};H.defCTS=function(){V.$cctor();return V.defCTS;};H.UncaughtAsyncError=function(bY){bR.log("WebSharper: Uncaught asynchronous exception",bY);};H.cancel=function(bY){bY.k({$:2,$0:new bd.New(bY.ct)});};H.scheduler=function(){V.$cctor();return V.scheduler;};I.Replace=function(bY,bZ,b0){function b1(b2){var b3,b4,b5;b3=b2.indexOf(bZ);return b3!==-1?(b4=I.ReplaceOnce(b2,bZ,b0),(b5=b3+b0.length,I.Substring(b4,0,b3+b0.length)+b1(b4.substring(b5)))):b2;}return b1(bY);};I.StartsWith=function(bY,bZ){return bY.substring(0,bZ.length)==bZ;};I.ReplaceOnce=function(bY,bZ,b0){return bY.replace(bZ,b0);};I.concat=function(bY,bZ){return w.ofSeq(bZ).join(bY);};I.Substring=function(bY,bZ,b0){return bY.substr(bZ,b0);};I.SplitChars=function(bY,bZ,b0){return I.Split(bY,new a.RegExp("["+I.RegexEscape(bZ.join(""))+"]"),b0);};I.Split=function(bY,bZ,b0){return b0===1?w.filter(function(b1){return b1!=="";},I.SplitWith(bY,bZ)):I.SplitWith(bY,bZ);};I.RegexEscape=function(bY){return bY.replace(new a.RegExp("[-\\/\\\\^$*+?.()|[\\]{}]","g"),"\\$&");};I.SplitWith=function(bY,bZ){return bY.split(bZ);};I.forall=function(bY,bZ){return F.forall(bY,I.protect(bZ));};I.protect=function(bY){return bY===null?"":bY;};K.NewGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(new a.RegExp("[xy]","g"),function(bY){var bZ,b0;bZ=bW.random()*16|0;b0=bY=="x"?bZ:bZ&3|8;return b0.toString(16);});};M=L.List=bV.Class({GetEnumerator:function(){return _5.Get(this);},GetEnumerator0:function(){return _5.Get0(this);}},null,M);N=L.Dictionary=bV.Class({get_Item:function(bY){return this.get(bY);},get:function(bY){var bZ,b0;bZ=this;b0=this.data[this.hash(bY)];return b0==null?_8.notPresent():w.pick(function(b1){var b2;b2=n.KeyValue(b1);return bZ.equals.apply(null,[b2[0],bY])?{$:1,$0:b2[1]}:null;},b0);},Clear:function(){this.data=[];this.count=0;},set_Item:function(bY,bZ){this.set(bY,bZ);},TryGetValue:function(bY,bZ){var b0,b1,b2;b0=this;b1=this.data[this.hash(bY)];return b1==null?false:(b2=w.tryPick(function(b3){var b4;b4=n.KeyValue(b3);return b0.equals.apply(null,[b4[0],bY])?{$:1,$0:b4[1]}:null;},b1),b2!=null&&b2.$==1&&(bZ.set(b2.$0),true));},Remove:function(bY){return this.remove(bY);},set:function(bY,bZ){var b0,b1,b2,b3;b0=this;b1=this.hash(bY);b2=this.data[b1];b2==null?(this.count=this.count+1,this.data[b1]=new a.Array({K:bY,V:bZ})):(b3=w.tryFindIndex(function(b4){return b0.equals.apply(null,[(n.KeyValue(b4))[0],bY]);},b2),b3==null?(this.count=this.count+1,b2.push({K:bY,V:bZ})):b2[b3.$0]={K:bY,V:bZ});},ContainsKey:function(bY){var bZ,b0;bZ=this;b0=this.data[this.hash(bY)];return b0==null?false:w.exists(function(b1){return bZ.equals.apply(null,[(n.KeyValue(b1))[0],bY]);},b0);},get_Keys:function(){return new bk.New(this);},remove:function(bY){var bZ,b0,b1,b2;bZ=this;b0=this.hash(bY);b1=this.data[b0];return b1==null?false:(b2=w.filter(function(b3){return!bZ.equals.apply(null,[(n.KeyValue(b3))[0],bY]);},b1),w.length(b2)<b1.length&&(this.count=this.count-1,this.data[b0]=b2,true));},get_Values:function(){return new bv.New(this);},GetEnumerator:function(){return _5.Get0(this);},GetEnumerator0:function(){return _5.Get0(w.concat(p.GetFieldValues(this.data)));}},f,N);N.New$5=bV.Ctor(function(){N.New$6.call(this,[],e.Equals,e.Hash);},N);N.New$6=bV.Ctor(function(bY,bZ,b0){var b1,b2;f.New.call(this);this.equals=bZ;this.hash=b0;this.count=0;this.data=[];b1=_5.Get(bY);try{while(b1.MoveNext()){b2=b1.Current();this.set(b2.K,b2.V);}}finally{if(typeof b1=="object"&&"Dispose"in b1)b1.Dispose();}},N);P.LoadLocalTemplates=function(bY){!P.LocalTemplatesLoaded()?(P.set_LocalTemplatesLoaded(true),P.LoadNestedTemplates(self.document.body,"")):void 0;P.LoadedTemplates().set_Item(bY,P.LoadedTemplateFile(""));};P.NamedTemplate=function(bY,bZ,b0){var b1,b2;b1=(b2=null,[P.LoadedTemplateFile(bY).TryGetValue(bZ==null?"":bZ.$0,{get:function(){return b2;},set:function(b3){b2=b3;}}),b2]);return b1[0]?P.ChildrenTemplate(b1[1].cloneNode(true),b0):(bR.warn("Local template doesn't exist",bZ),Q.get_Empty());};P.LocalTemplatesLoaded=function(){_.$cctor();return _.LocalTemplatesLoaded;};P.set_LocalTemplatesLoaded=function(bY){_.$cctor();_.LocalTemplatesLoaded=bY;};P.LoadNestedTemplates=function(bY,bZ){var b1,b2,b3,b4,b5,b6,b7,b8,b9,b_,b$,ca,cb;function b0(cc){var cd,ce;if(!b1.ContainsKey(cc)){cd=(ce=null,[b2.TryGetValue(cc,{get:function(){return ce;},set:function(cf){ce=cf;}}),ce]);cd[0]?(cb.Add(cc),b2.Remove(cc),P.PrepareTemplateStrict(bZ,{$:1,$0:cc},cd[1],{$:1,$0:b0})):bR.warn(cb.Contains(cc)?"Encountered loop when instantiating "+cc:"Local template does not exist: "+cc);}}b1=P.LoadedTemplateFile(bZ);b2=new N.New$5();b3=bY.querySelectorAll("[ws-template]");for(b4=0,b5=b3.length-1;b4<=b5;b4++){b6=b3[b4];b7=b6.getAttribute("ws-template").toLowerCase();b6.removeAttribute("ws-template");b2.set_Item(b7,P.FakeRootSingle(b6));}b8=bY.querySelectorAll("[ws-children-template]");for(b9=0,b_=b8.length-1;b9<=b_;b9++){b$=b8[b9];ca=b$.getAttribute("ws-children-template").toLowerCase();b$.removeAttribute("ws-children-template");b2.set_Item(ca,P.FakeRoot(b$));}cb=new _1.New$3();while(b2.count>0)b0(F.head(b2.get_Keys()));};P.LoadedTemplates=function(){_.$cctor();return _.LoadedTemplates;};P.LoadedTemplateFile=function(bY){var bZ,b0,b1;bZ=(b0=null,[P.LoadedTemplates().TryGetValue(bY,{get:function(){return b0;},set:function(b2){b0=b2;}}),b0]);return bZ[0]?bZ[1]:(b1=new N.New$5(),(P.LoadedTemplates().set_Item(bY,b1),b1));};P.ChildrenTemplate=function(bY,bZ){var b0,b1,b2,b3,b4;b0=P.InlineTemplate(bY,F.append(bZ,P.GlobalHoles().get_Values()));b1=b0[1];b2=b0[0];b3=b2.Els;return!e.Equals(b3,null)&&b3.length===1&&(w.get(b3,0)instanceof _4&&(e.Equals(w.get(b3,0).nodeType,_4.ELEMENT_NODE)&&(b4=w.get(b3,0),true)))?bg.TreeNode(b2,b1):Q.Mk({$:6,$0:b2},b1);};P.FakeRootSingle=function(bY){var bZ,b0,b1,b2;bY.removeAttribute("ws-template");bZ=bY.getAttribute("ws-replace");bZ===null?void 0:(bY.removeAttribute("ws-replace"),b0=bY.parentNode,e.Equals(b0,null)?void 0:(b1=self.document.createElement(bY.tagName),b1.setAttribute("ws-replace",bZ),b0.replaceChild(b1,bY)));b2=self.document.createElement("div");b2.appendChild(bY);return b2;};P.FakeRoot=function(bY){var bZ;bZ=self.document.createElement("div");while(bY.hasChildNodes())bZ.appendChild(bY.firstChild);return bZ;};P.PrepareTemplateStrict=function(bY,bZ,b0,b1){var b2;function b3(b9,b_){var b$,ca,cb,cc,cd,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz;function ce(cA){}while(true)switch(b9){case 0:if(b_!==null){b$=b_.nextSibling;if(e.Equals(b_.nodeType,_4.TEXT_NODE))bh.convertTextNode(b_);else if(e.Equals(b_.nodeType,_4.ELEMENT_NODE))b5(b_);b_=b$;}else return null;break;case 1:cf=bi.string(b_.nodeName,{$:1,$0:3},null).toLowerCase();cg=(ca=cf.indexOf("."),ca===-1?[bY,cf]:[bi.string(cf,null,{$:1,$0:ca-1}),bi.string(cf,{$:1,$0:ca+1},null)]);ch=cg[1];ci=cg[0];if(ci!==""&&!P.LoadedTemplates().ContainsKey(ci))return bh.failNotLoaded(ch);else{if(ci===""&&b1!=null)b1.$0(ch);cj=P.LoadedTemplates().get_Item(ci);if(!cj.ContainsKey(ch))return bh.failNotLoaded(ch);else{ck=cj.get_Item(ch);cl=ck.cloneNode(true);cm=new _1.New$3();cn=new N.New$5();co=b_.attributes;for(cp=0,cq=co.length-1;cp<=cq;cp++){cr=co.item(cp).name.toLowerCase();cn.set_Item(cr,(cs=co.item(cp).nodeValue,cs===""?cr:cs.toLowerCase()));!cm.Add(cr)?bR.warn("Hole mapped twice",cr):void 0;}for(ct=0,cu=b_.childNodes.length-1;ct<=cu;ct++){cv=b_.childNodes[ct];e.Equals(cv.nodeType,_4.ELEMENT_NODE)?!cm.Add(cv.nodeName.toLowerCase())?bR.warn("Hole filled twice",ch):void 0:void 0;}cw=b_.childNodes.length===1&&e.Equals(b_.firstChild.nodeType,_4.TEXT_NODE);if(cw){cc=bh.fillTextHole(cl,b_.firstChild.textContent,ch);((function(cA){return function(cB){if(cB!=null)cA(cB.$0);};}((cd=function(cA){return function(cB){return cA.Add(cB);};}(cm),function(cA){return ce(cd(cA));})))(cc));}bh.removeHolesExcept(cl,cm);if(!cw){for(cx=0,cy=b_.childNodes.length-1;cx<=cy;cx++){cz=b_.childNodes[cx];e.Equals(cz.nodeType,_4.ELEMENT_NODE)?cz.hasAttributes()?bh.fillInstanceAttrs(cl,cz):b4(cl,cz):void 0;}}bh.mapHoles(cl,cn);bh.fill(cl,b_.parentNode,b_);b_.parentNode.removeChild(b_);return;}}break;}}function b4(b9,b_){var b$,cb,cc;function ca(cd,ce){var cf;if(cb==="title"&&b_.hasChildNodes()){cf=bj.ParseHTMLIntoFakeRoot(b_.textContent);b_.removeChild(b_.firstChild);while(cf.hasChildNodes())b_.appendChild(cf.firstChild);}else null;b5(b_);return bh.fill(b_,cd,ce);}cb=b_.nodeName.toLowerCase();P.foreachNotPreserved(b9,"[ws-attr-holes]",function(cd){var ce,cf,cg,ch,ci;ce=I.SplitChars(cd.getAttribute("ws-attr-holes"),[" "],1);for(cf=0,cg=ce.length-1;cf<=cg;cf++){ch=w.get(ce,cf);cd.setAttribute(ch,(ci=new a.RegExp("\\${"+cb+"}","ig"),cd.getAttribute(ch).replace(ci,b_.textContent)));}});cc=b9.querySelector("[ws-hole="+cb+"]");if(e.Equals(cc,null)){b$=b9.querySelector("[ws-replace="+cb+"]");return e.Equals(b$,null)?null:(ca(b$.parentNode,b$),void b$.parentNode.removeChild(b$));}else{while(cc.hasChildNodes())cc.removeChild(cc.lastChild);cc.removeAttribute("ws-hole");return ca(cc,null);}}function b5(b9){if(!b9.hasAttribute("ws-preserve"))if(I.StartsWith(b9.nodeName.toLowerCase(),"ws-"))b7(b9);else{bh.convertAttrs(b9);b6(b9.firstChild);}}function b6(b9){return b3(0,b9);}function b7(b9){return b3(1,b9);}function b8(b9){var b_,b$,ca,cb;while(true){b_=b9.querySelector("[ws-template]");if(e.Equals(b_,null)){b$=b9.querySelector("[ws-children-template]");if(e.Equals(b$,null))return null;else{ca=b$.getAttribute("ws-children-template");b$.removeAttribute("ws-children-template");P.PrepareTemplateStrict(bY,{$:1,$0:ca},b$,null);b9=b9;}}else{cb=b_.getAttribute("ws-template");(P.PrepareSingleTemplate(bY,{$:1,$0:cb},b_))(null);b9=b9;}}}b2=(bZ==null?"":bZ.$0).toLowerCase();P.LoadedTemplateFile(bY).set_Item(b2,b0);b0.hasChildNodes()?(b8(b0),b6(b0.firstChild)):void 0;};P.InlineTemplate=function(bY,bZ){var b0,b1,b2,b3,b6,b7,b8,b9,b_,b$,ca;function b4(cb,cc){var cd,ce,cf;cd=bs.Insert(cb,cc);b7.push(bs.Updates(cd));b8.push([cb,cd]);ce=bV.GetOptional(cd.OnAfterRender);return ce==null?null:(cf=ce.$0,void b9.push(function(){cf(cb);}));}function b5(cb){var cc,cd;cc=(cd=null,[b_.TryGetValue(cb,{get:function(){return cd;},set:function(ce){cd=ce;}}),cd]);return cc[0]?cc[1].$==0?{$:1,$0:cc[1].$1}:cc[1].$==1?{$:1,$0:Q.TextNode(cc[1].$1)}:cc[1].$==2?{$:1,$0:Q.TextView(cc[1].$1)}:cc[1].$==8?{$:1,$0:Q.TextView(cc[1].$1.get_View())}:cc[1].$==9?{$:1,$0:Q.TextView(y.Map(a.String,cc[1].$1.get_View()))}:cc[1].$==10?{$:1,$0:Q.TextView(y.Map(function(ce){return ce.get_Input();},cc[1].$1.get_View()))}:cc[1].$==11?{$:1,$0:Q.TextView(y.Map(a.String,cc[1].$1.get_View()))}:cc[1].$==12?{$:1,$0:Q.TextView(y.Map(function(ce){return ce.get_Input();},cc[1].$1.get_View()))}:cc[1].$==13?{$:1,$0:Q.TextView(y.Map(a.String,cc[1].$1.get_View()))}:(bR.warn("Content hole filled with attribute data",cb),null):null;}b6=[];b7=[];b8=[];b9=[];b_=new N.New$5();b$=_5.Get(bZ);try{while(b$.MoveNext()){ca=b$.Current();b_.set_Item(ca.$0,ca);}}finally{if(typeof b$=="object"&&"Dispose"in b$)b$.Dispose();}b0=bj.ChildrenArray(bY);P.foreachNotPreserved(bY,"[ws-hole]",function(cb){var cc,cd,ce;ce=cb.getAttribute("ws-hole");cb.removeAttribute("ws-hole");while(cb.hasChildNodes())cb.removeChild(cb.lastChild);cc=b5(ce);cc!=null&&cc.$==1?(cd=cc.$0,ba.LinkElement(cb,cd.docNode),b6.push(be.New(bs.Empty(cb),cd.docNode,null,cb,S.Int(),null)),b7.push(cd.updates)):void 0;});P.foreachNotPreserved(bY,"[ws-replace]",function(cb){var cc,cd,ce,cf,cg,ch;cc=b5(cb.getAttribute("ws-replace"));cc!=null&&cc.$==1?(cd=cc.$0,ce=cb.parentNode,cf=self.document.createTextNode(""),ce.replaceChild(cf,cb),cg=ba.InsertBeforeDelim(cf,cd.docNode),ch=w.tryFindIndex(function(ci){return cb===ci;},b0),ch==null?void 0:w.set(b0,ch.$0,cd.docNode),b6.push(be.New(bs.Empty(ce),cd.docNode,{$:1,$0:[cg,cf]},ce,S.Int(),null)),b7.push(cd.updates)):void 0;});P.foreachNotPreserved(bY,"[ws-attr]",function(cb){var cc,cd,ce;cc=cb.getAttribute("ws-attr");cb.removeAttribute("ws-attr");cd=(ce=null,[b_.TryGetValue(cc,{get:function(){return ce;},set:function(cf){ce=cf;}}),ce]);cd[0]?cd[1].$==3?b4(cb,cd[1].$1):bR.warn("Attribute hole filled with non-attribute data",cc):void 0;});P.foreachNotPreserved(bY,"[ws-on]",function(cb){b4(cb,Y.Concat(w.choose(function(cc){var cd,ce,cf;cd=I.SplitChars(cc,[":"],1);ce=(cf=null,[b_.TryGetValue(w.get(cd,1),{get:function(){return cf;},set:function(cg){cf=cg;}}),cf]);return ce[0]?ce[1].$==4?{$:1,$0:bt.Handler(w.get(cd,0),ce[1].$1)}:ce[1].$==5?{$:1,$0:Y.Handler(w.get(cd,0),ce[1].$1)}:(bR.warn("Event hole on"+w.get(cd,0)+" filled with non-event data",w.get(cd,1)),null):null;},I.SplitChars(cb.getAttribute("ws-on"),[" "],1))));cb.removeAttribute("ws-on");});P.foreachNotPreserved(bY,"[ws-onafterrender]",function(cb){var cc,cd,ce;cc=cb.getAttribute("ws-onafterrender");cd=(ce=null,[b_.TryGetValue(cc,{get:function(){return ce;},set:function(cf){ce=cf;}}),ce]);cd[0]?cd[1].$==6?(cb.removeAttribute("ws-onafterrender"),b4(cb,bt.OnAfterRender(cd[1].$1))):cd[1].$==7?(cb.removeAttribute("ws-onafterrender"),b4(cb,bt.OnAfterRender(cd[1].$1))):bR.warn("onafterrender hole filled with non-onafterrender data",cc):void 0;});P.foreachNotPreserved(bY,"[ws-var]",function(cb){var cc,cd,ce;cc=cb.getAttribute("ws-var");cb.removeAttribute("ws-var");cd=(ce=null,[b_.TryGetValue(cc,{get:function(){return ce;},set:function(cf){ce=cf;}}),ce]);cd[0]?cd[1].$==8?b4(cb,bt.Value(cd[1].$1)):cd[1].$==9?b4(cb,bt.Checked(cd[1].$1)):cd[1].$==10?b4(cb,bt.IntValue(cd[1].$1)):cd[1].$==11?b4(cb,bt.IntValueUnchecked(cd[1].$1)):cd[1].$==12?b4(cb,bt.FloatValue(cd[1].$1)):cd[1].$==13?b4(cb,bt.FloatValueUnchecked(cd[1].$1)):bR.warn("Var hole filled with non-Var data",cc):void 0;});P.foreachNotPreserved(bY,"[ws-attr-holes]",function(cb){var cc,cd,ce,cf;cc=new a.RegExp(P.TextHoleRE(),"g");cd=I.SplitChars(cb.getAttribute("ws-attr-holes"),[" "],1);cb.removeAttribute("ws-attr-holes");for(ce=0,cf=cd.length-1;ce<=cf;ce++)(function(){var cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs;cp=w.get(cd,ce);cq=cb.getAttribute(cp);cg=null;ch=0;cr=[];while(cg=cc.exec(cq),cg!==null){cs=bi.string(cq,{$:1,$0:ch},{$:1,$0:cc.lastIndex-w.get(cg,0).length-1});ch=cc.lastIndex;cr.push([cs,w.get(cg,1)]);}cj=bi.string(cq,{$:1,$0:ch},null);cc.lastIndex=0;ck=w.foldBack(function(ct,cu){return(function(cv){var cw,cx;cw=cv[0];cx=cv[1];return function(cy){var cz,cA,cB,cC,cD;cz=cy[0];cA=cy[1];cB=(cC=(cD=null,[b_.TryGetValue(cx,{get:function(){return cD;},set:function(cE){cD=cE;}}),cD]),cC[0]?cC[1].$==1?{$:0,$0:cC[1].$1}:cC[1].$==2?{$:1,$0:cC[1].$1}:cC[1].$==8?{$:1,$0:cC[1].$1.get_View()}:cC[1].$==9?{$:1,$0:y.Map(a.String,cC[1].$1.get_View())}:cC[1].$==10?{$:1,$0:y.Map(function(cE){return cE.get_Input();},cC[1].$1.get_View())}:cC[1].$==11?{$:1,$0:y.Map(a.String,cC[1].$1.get_View())}:cC[1].$==12?{$:1,$0:y.Map(function(cE){return cE.get_Input();},cC[1].$1.get_View())}:cC[1].$==13?{$:1,$0:y.Map(a.String,cC[1].$1.get_View())}:(bR.warn("Attribute value hole filled with non-text data",cx),{$:0,$0:""}):{$:0,$0:""});return cB.$==1?[cw,new k({$:1,$0:cz===""?cB.$0:y.Map(function(cE){return cE+cz;},cB.$0),$1:cA})]:[cw+cB.$0+cz,cA];};}(ct))(cu);},cr,[cj,k.Empty]);return b4(cb,ck[1].$==1?ck[1].$1.$==1?ck[1].$1.$1.$==1?ck[1].$1.$1.$1.$==0?(cl=ck[0],bt.Dynamic(cp,y.Map3(function(ct,cu,cv){return cl+ct+cu+cv;},ck[1].$0,ck[1].$1.$0,ck[1].$1.$1.$0))):(cm=ck[0],bt.Dynamic(cp,y.Map(function(ct){return cm+I.concat("",ct);},y.Sequence(ck[1])))):(cn=ck[0],bt.Dynamic(cp,y.Map2(function(ct,cu){return cn+ct+cu;},ck[1].$0,ck[1].$1.$0))):ck[0]===""?bt.Dynamic(cp,ck[1].$0):(co=ck[0],bt.Dynamic(cp,y.Map(function(ct){return co+ct;},ck[1].$0))):Y.Create(cp,ck[0]));}());});return[bV.DeleteEmptyFields({Els:b0,Dirty:true,Holes:b6,Attrs:b8,Render:(b1=b9.length==0?null:{$:1,$0:function(cb){w.iter(function(cc){cc(cb);},b9);}},b1?b1.$0:void 0),El:(b2=!e.Equals(b0,null)&&b0.length===1&&(w.get(b0,0)instanceof _4&&(w.get(b0,0)instanceof a.Element&&(b3=w.get(b0,0),true)))?{$:1,$0:b3}:null,b2?b2.$0:void 0)},["Render","El"]),br.TreeReduce(y.Const(),y.Map2Unit,b7)];};P.GlobalHoles=function(){_.$cctor();return _.GlobalHoles;};P.foreachNotPreserved=function(bY,bZ,b0){bj.IterSelector(bY,bZ,function(b1){if(b1.closest("[ws-preserve]")==null)b0(b1);});};P.PrepareSingleTemplate=function(bY,bZ,b0){var b1;b1=P.FakeRootSingle(b0);return function(b2){P.PrepareTemplateStrict(bY,bZ,b1,b2);};};P.TextHoleRE=function(){_.$cctor();return _.TextHoleRE;};Q=g.Doc=bV.Class({},f,Q);Q.RunById=function(bY,bZ){var b0;b0=self.document.getElementById(bY);e.Equals(b0,null)?n.FailWith("invalid id: "+bY):Q.Run(b0,bZ);};Q.Convert=function(bY,bZ){return Q.Flatten(y.MapSeqCached(bY,bZ));};Q.Run=function(bY,bZ){ba.LinkElement(bY,bZ.docNode);Q.RunInPlace(false,bY,bZ);};Q.Flatten=function(bY){return Q.EmbedView(y.Map(Q.Concat,bY));};Q.get_Empty=function(){return Q.Mk(null,y.Const());};Q.RunInPlace=function(bY,bZ,b0){var b1;b1=ba.CreateRunState(bZ,b0.docNode);y.Sink(bl.get_UseAnimations()||bm.BatchUpdatesEnabled()?bn.StartProcessor(ba.PerformAnimatedUpdate(bY,b1,b0.docNode)):function(){ba.PerformSyncUpdate(bY,b1,b0.docNode);},b0.updates);};Q.Concat=function(bY){var bZ;bZ=br.ofSeqNonCopying(bY);return br.TreeReduce(Q.get_Empty(),Q.Append,bZ);};Q.EmbedView=function(bY){var bZ;bZ=ba.CreateEmbedNode();return Q.Mk({$:2,$0:bZ},y.Map(a.ignore,y.Bind(function(b0){ba.UpdateEmbedNode(bZ,b0.docNode);return b0.updates;},bY)));};Q.Mk=function(bY,bZ){return new Q.New(bY,bZ);};Q.Append=function(bY,bZ){return Q.Mk({$:0,$0:bY.docNode,$1:bZ.docNode},y.Map2Unit(bY.updates,bZ.updates));};Q.TextNode=function(bY){return Q.Mk({$:5,$0:self.document.createTextNode(bY)},y.Const());};Q.TextView=function(bY){var bZ;bZ=ba.CreateTextNode();return Q.Mk({$:4,$0:bZ},y.Map(function(b0){ba.UpdateTextNode(bZ,b0);},bY));};Q.New=bV.Ctor(function(bY,bZ){f.New.call(this);this.docNode=bY;this.updates=bZ;},Q);S.Int=function(){S.set_counter(S.counter()+1);return S.counter();};S.set_counter=function(bY){bb.$cctor();bb.counter=bY;};S.counter=function(){bb.$cctor();return bb.counter;};T=E.ArrayStorage=bV.Class({SSet:function(bY){return w.ofSeq(bY);},SSetAt:function(bY,bZ,b0){w.set(b0,bY,bZ);return b0;},SAppend:function(bY,bZ){bZ.push(bY);return bZ;},SInit:function(){return this.init;}},f,T);T.New=bV.Ctor(function(bY){f.New.call(this);this.init=bY;},T);w.ofSeq=function(bY){var bZ,b0;if(bY instanceof a.Array)return bY.slice();else if(bY instanceof k)return w.ofList(bY);else{bZ=[];b0=_5.Get(bY);try{while(b0.MoveNext())bZ.push(b0.Current());return bZ;}finally{if(typeof b0=="object"&&"Dispose"in b0)b0.Dispose();}}};w.tryFindIndex=function(bY,bZ){var b0,b1;b0=null;b1=0;while(b1<bZ.length&&b0==null){bY(bZ[b1])?b0={$:1,$0:b1}:void 0;b1=b1+1;}return b0;};w.init=function(bY,bZ){var b0,b1,b2;bY<0?n.FailWith("Negative size given."):null;b0=new a.Array(bY);for(b1=0,b2=bY-1;b1<=b2;b1++)b0[b1]=bZ(b1);return b0;};w.map=function(bY,bZ){var b0,b1,b2;b0=new a.Array(bZ.length);for(b1=0,b2=bZ.length-1;b1<=b2;b1++)b0[b1]=bY(bZ[b1]);return b0;};w.choose=function(bY,bZ){var b0,b1,b2,b3;b0=[];for(b1=0,b2=bZ.length-1;b1<=b2;b1++){b3=bY(bZ[b1]);b3==null?void 0:b0.push(b3.$0);}return b0;};w.ofList=function(bY){var bZ,b0;b0=[];bZ=bY;while(!(bZ.$==0)){b0.push(j.head(bZ));bZ=j.tail(bZ);}return b0;};w.pick=function(bY,bZ){var b0;b0=w.tryPick(bY,bZ);return b0==null?n.FailWith("KeyNotFoundException"):b0.$0;};w.tryPick=function(bY,bZ){var b0,b1,b2;b0=null;b1=0;while(b1<bZ.length&&b0==null){b2=bY(bZ[b1]);b2!=null&&b2.$==1?b0=b2:void 0;b1=b1+1;}return b0;};w.exists=function(bY,bZ){var b0,b1,b2,b3;b0=false;b1=0;b3=w.length(bZ);while(!b0&&b1<b3)if(bY(bZ[b1]))b0=true;else b1=b1+1;return b0;};w.concat=function(bY){return a.Array.prototype.concat.apply([],w.ofSeq(bY));};w.filter=function(bY,bZ){var b0,b1,b2;b0=[];for(b1=0,b2=bZ.length-1;b1<=b2;b1++)if(bY(bZ[b1]))b0.push(bZ[b1]);return b0;};w.foldBack=function(bY,bZ,b0){var b1,b2,b3,b4,b5;b1=b0;b3=bZ.length;for(b4=1,b5=b3;b4<=b5;b4++)b1=bY(bZ[b3-b4],b1);return b1;};w.iter=function(bY,bZ){var b0,b1;for(b0=0,b1=bZ.length-1;b0<=b1;b0++)bY(bZ[b0]);};w.forall=function(bY,bZ){var b0,b1,b2,b3;b0=true;b1=0;b3=w.length(bZ);while(b0&&b1<b3)if(bY(bZ[b1]))b1=b1+1;else b0=false;return b0;};w.create=function(bY,bZ){var b0,b1,b2;b0=new a.Array(bY);for(b1=0,b2=bY-1;b1<=b2;b1++)b0[b1]=bZ;return b0;};y=g.View=bV.Class({},null,y);D.Obsolete=function(bY){var bZ,b0,b1,b2,b3;b0=bY.s;if(b0==null||(b0!=null&&b0.$==2?(bZ=b0.$1,false):b0!=null&&b0.$==3?(bZ=b0.$1,false):true))void 0;else{bY.s=null;for(b1=0,b2=w.length(bZ)-1;b1<=b2;b1++){b3=w.get(bZ,b1);typeof b3=="object"?function(b4){D.Obsolete(b4);}(b3):b3();}}};D.New=function(bY){return{s:bY};};U.New=function(bY,bZ){return{k:bY,ct:bZ};};V.$cctor=function(){V.$cctor=a.ignore;V.noneCT=W.New(false,[]);V.scheduler=new _6.New();V.defCTS=[new _7.New()];V.Zero=H.Return();V.GetCT=function(bY){bY.k({$:0,$0:bY.ct});};};W.New=function(bY,bZ){return{c:bY,r:bZ};};Y=g.AttrProxy=bV.Class({},null,Y);Y.Handler=function(bY,bZ){return Y.HandlerImpl(bY,bZ);};Y.Concat=function(bY){var bZ;bZ=br.ofSeqNonCopying(bY);return br.TreeReduce(bs.EmptyAttr(),Y.Append,bZ);};Y.Create=function(bY,bZ){return bs.Static(function(b0){b0.setAttribute(bY,bZ);});};Y.HandlerImpl=function(bY,bZ){return bs.Static(function(b0){b0.addEventListener(bY,function(b1){return(bZ(b0))(b1);},false);});};Y.Append=function(bY,bZ){return bs.AppendTree(bY,bZ);};Z=g.CheckedInput=bV.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,Z);_0.TryParseInt32=function(bY,bZ){return _0.TryParse(bY,-2147483648,2147483647,bZ);};_1=L.HashSet=bV.Class({Add:function(bY){return this.add(bY);},Contains:function(bY){var bZ;bZ=this.data[this.hash(bY)];return bZ==null?false:this.arrContains(bY,bZ);},add:function(bY){var bZ,b0;bZ=this.hash(bY);b0=this.data[bZ];return b0==null?(this.data[bZ]=[bY],this.count=this.count+1,true):this.arrContains(bY,b0)?false:(b0.push(bY),this.count=this.count+1,true);},arrContains:function(bY,bZ){var b0,b1,b2,b3;b0=true;b1=0;b3=bZ.length;while(b0&&b1<b3)if(this.equals.apply(null,[bZ[b1],bY]))b0=false;else b1=b1+1;return!b0;},ExceptWith:function(bY){var bZ;bZ=_5.Get(bY);try{while(bZ.MoveNext())this.Remove(bZ.Current());}finally{if(typeof bZ=="object"&&"Dispose"in bZ)bZ.Dispose();}},get_Count:function(){return this.count;},CopyTo:function(bY){var bZ,b0,b1,b2;bZ=0;b0=bB.concat(this.data);for(b1=0,b2=b0.length-1;b1<=b2;b1++)w.set(bY,b1,b0[b1]);},IntersectWith:function(bY){var bZ,b0,b1,b2,b3;bZ=new _1.New$4(bY,this.equals,this.hash);b0=bB.concat(this.data);for(b1=0,b2=b0.length-1;b1<=b2;b1++){b3=b0[b1];!bZ.Contains(b3)?this.Remove(b3):void 0;}},Remove:function(bY){var bZ;bZ=this.data[this.hash(bY)];return bZ==null?false:this.arrRemove(bY,bZ)&&(this.count=this.count-1,true);},arrRemove:function(bY,bZ){var b0,b1,b2,b3;b0=true;b1=0;b3=bZ.length;while(b0&&b1<b3)if(this.equals.apply(null,[bZ[b1],bY])){bZ.splice.apply(bZ,[b1,1]);b0=false;}else b1=b1+1;return!b0;},GetEnumerator:function(){return _5.Get(bB.concat(this.data));},GetEnumerator0:function(){return _5.Get(bB.concat(this.data));}},f,_1);_1.New$3=bV.Ctor(function(){_1.New$4.call(this,[],e.Equals,e.Hash);},_1);_1.New$4=bV.Ctor(function(bY,bZ,b0){var b1;f.New.call(this);this.equals=bZ;this.hash=b0;this.data=[];this.count=0;b1=_5.Get(bY);try{while(b1.MoveNext())this.add(b1.Current());}finally{if(typeof b1=="object"&&"Dispose"in b1)b1.Dispose();}},_1);_1.New$2=bV.Ctor(function(bY){_1.New$4.call(this,bY,e.Equals,e.Hash);},_1);_2.$cctor=function(){_2.$cctor=a.ignore;_2.initialized=new N.New$5();};_2=u.TemplateInitializer=bV.Class({},f,_2);_2.GetOrAddHoleFor=function(bY,bZ,b0){var b1,b2,b3,b4;_2.$cctor();b1=_2.GetHolesFor(bY);b2=(b3=null,[b1.TryGetValue(bZ,{get:function(){return b3;},set:function(b5){b3=b5;}}),b3]);return b2[0]?b2[1]:(b4=b0(),(b1.set_Item(bZ,b4),b4));};_2.GetHolesFor=function(bY){var bZ,b0,b1;_2.$cctor();bZ=(b0=null,[_2.initialized.TryGetValue(bY,{get:function(){return b0;},set:function(b2){b0=b2;}}),b0]);return bZ[0]?bZ[1]:(b1=new N.New$5(),(_2.initialized.set_Item(bY,b1),b1));};_5.Get=function(bY){return bY instanceof a.Array?_5.ArrayEnumerator(bY):e.Equals(typeof bY,"string")?_5.StringEnumerator(bY):bY.GetEnumerator();};_5.ArrayEnumerator=function(bY){return new _9.New(0,null,function(bZ){var b0;b0=bZ.s;return b0<w.length(bY)&&(bZ.c=w.get(bY,b0),bZ.s=b0+1,true);},void 0);};_5.StringEnumerator=function(bY){return new _9.New(0,null,function(bZ){var b0;b0=bZ.s;return b0<bY.length&&(bZ.c=bY[b0],bZ.s=b0+1,true);},void 0);};_5.Get0=function(bY){return bY instanceof a.Array?_5.ArrayEnumerator(bY):e.Equals(typeof bY,"string")?_5.StringEnumerator(bY):"GetEnumerator0"in bY?bY.GetEnumerator0():bY.GetEnumerator();};_6=H.Scheduler=bV.Class({Fork:function(bY){var bZ;bZ=this;this.robin.push(bY);this.idle?(this.idle=false,a.setTimeout(function(){bZ.tick();},0)):void 0;},tick:function(){var bY,bZ,b0;bZ=this;b0=bX.now();bY=true;while(bY)if(this.robin.length===0){this.idle=true;bY=false;}else{(this.robin.shift())();bX.now()-b0>40?(a.setTimeout(function(){bZ.tick();},0),bY=false):void 0;}}},f,_6);_6.New=bV.Ctor(function(){f.New.call(this);this.idle=true;this.robin=[];},_6);_7=d.CancellationTokenSource=bV.Class({},f,_7);_7.New=bV.Ctor(function(){f.New.call(this);this.c=false;this.pending=null;this.r=[];this.init=1;},_7);_8.notPresent=function(){return n.FailWith("The given key was not present in the dictionary.");};_9=_5.T=bV.Class({MoveNext:function(){return this.n(this);},Current:function(){return this.c;},Dispose:function(){if(this.d)this.d(this);}},f,_9);_9.New=bV.Ctor(function(bY,bZ,b0,b1){f.New.call(this);this.s=bY;this.c=bZ;this.n=b0;this.d=b1;},_9);_.$cctor=function(){_.$cctor=a.ignore;_.LoadedTemplates=new N.New$5();_.LocalTemplatesLoaded=false;_.GlobalHoles=new N.New$5();_.TextHoleRE="\\${([^}]+)}";_.RenderedFullDocTemplate=null;};ba.LinkElement=function(bY,bZ){ba.InsertDoc(bY,bZ,null);};ba.InsertDoc=function(bY,bZ,b0){var b1,b2,b3;while(true)if(bZ!=null&&bZ.$==1)return ba.InsertNode(bY,bZ.$0.El,b0);else if(bZ!=null&&bZ.$==2){b1=bZ.$0;b1.Dirty=false;bZ=b1.Current;}else if(bZ==null)return b0;else if(bZ!=null&&bZ.$==4)return ba.InsertNode(bY,bZ.$0.Text,b0);else if(bZ!=null&&bZ.$==5)return ba.InsertNode(bY,bZ.$0,b0);else if(bZ!=null&&bZ.$==6)return w.foldBack(function(b4,b5){return(((bV.Curried3(function(b6,b7,b8){return b7==null||b7.constructor===X?ba.InsertDoc(b6,b7,b8):ba.InsertNode(b6,b7,b8);}))(bY))(b4))(b5);},bZ.$0.Els,b0);else{b2=bZ.$1;b3=bZ.$0;bZ=b3;b0=ba.InsertDoc(bY,b2,b0);}};ba.CreateRunState=function(bY,bZ){return bx.New(by.get_Empty(),ba.CreateElemNode(bY,bs.EmptyAttr(),bZ));};ba.PerformAnimatedUpdate=function(bY,bZ,b0){var b1;return bl.get_UseAnimations()?(b1=null,H.Delay(function(){var b2,b3,b4;b2=by.FindAll(b0);b3=ba.ComputeChangeAnim(bZ,b2);b4=ba.ComputeEnterAnim(bZ,b2);return H.Bind(bl.Play(bl.Append(b3,ba.ComputeExitAnim(bZ,b2))),function(){return H.Bind(ba.SyncElemNodesNextFrame(bY,bZ),function(){return H.Bind(bl.Play(b4),function(){bZ.PreviousNodes=b2;return H.Return(null);});});});})):ba.SyncElemNodesNextFrame(bY,bZ);};ba.PerformSyncUpdate=function(bY,bZ,b0){var b1;b1=by.FindAll(b0);ba.SyncElemNode(bY,bZ.Top);bZ.PreviousNodes=b1;};ba.CreateEmbedNode=function(){return{Current:null,Dirty:false};};ba.UpdateEmbedNode=function(bY,bZ){bY.Current=bZ;bY.Dirty=true;};ba.InsertBeforeDelim=function(bY,bZ){var b0,b1;b0=bY.parentNode;b1=self.document.createTextNode("");b0.insertBefore(b1,bY);ba.LinkPrevElement(bY,bZ);return b1;};ba.InsertNode=function(bY,bZ,b0){bj.InsertAt(bY,b0,bZ);return bZ;};ba.CreateElemNode=function(bY,bZ,b0){var b1;ba.LinkElement(bY,b0);b1=bs.Insert(bY,bZ);return be.New(b1,b0,null,bY,S.Int(),bV.GetOptional(b1.OnAfterRender));};ba.SyncElemNodesNextFrame=function(bY,bZ){function b0(b1){a.requestAnimationFrame(function(){ba.SyncElemNode(bY,bZ.Top);b1();});}return bm.BatchUpdatesEnabled()?H.FromContinuations(function(b1,b2,b3){return b0.apply(null,[b1,b2,b3]);}):(ba.SyncElemNode(bY,bZ.Top),H.Return(null));};ba.ComputeExitAnim=function(bY,bZ){return bl.Concat(w.map(function(b0){return bs.GetExitAnim(b0.Attr);},by.ToArray(by.Except(bZ,by.Filter(function(b0){return bs.HasExitAnim(b0.Attr);},bY.PreviousNodes)))));};ba.ComputeEnterAnim=function(bY,bZ){return bl.Concat(w.map(function(b0){return bs.GetEnterAnim(b0.Attr);},by.ToArray(by.Except(bY.PreviousNodes,by.Filter(function(b0){return bs.HasEnterAnim(b0.Attr);},bZ)))));};ba.ComputeChangeAnim=function(bY,bZ){var b0;function b1(b2){return bs.HasChangeAnim(b2.Attr);}b0=function(b2){return by.Filter(b1,b2);};return bl.Concat(w.map(function(b2){return bs.GetChangeAnim(b2.Attr);},by.ToArray(by.Intersect(b0(bY.PreviousNodes),b0(bZ)))));};ba.SyncElemNode=function(bY,bZ){!bY?ba.SyncElement(bZ):void 0;ba.Sync(bZ.Children);ba.AfterRender(bZ);};ba.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};ba.UpdateTextNode=function(bY,bZ){bY.Value=bZ;bY.Dirty=true;};ba.LinkPrevElement=function(bY,bZ){ba.InsertDoc(bY.parentNode,bZ,bY);};ba.SyncElement=function(bY){function bZ(b0){function b1(b2){var b3,b4,b5,b6;while(true){if(b2!=null&&b2.$==0){b4=b2.$1;b5=b2.$0;if(b1(b5))return true;else b2=b4;}else if(b2!=null&&b2.$==2){b6=b2.$0;if(b6.Dirty)return true;else b2=b6.Current;}else return b2!=null&&b2.$==6&&(b3=b2.$0,b3.Dirty||w.exists(bZ,b3.Holes));}}return b1(b0.Children);}bs.Sync(bY.El,bY.Attr);bZ(bY)?ba.DoSyncElement(bY):void 0;};ba.Sync=function(bY){var bZ,b0,b1,b2,b3;while(true){if(bY!=null&&bY.$==1)return ba.SyncElemNode(false,bY.$0);else if(bY!=null&&bY.$==2){b1=bY.$0;bY=b1.Current;}else if(bY==null)return null;else if(bY!=null&&bY.$==5)return null;else if(bY!=null&&bY.$==4){bZ=bY.$0;return bZ.Dirty?(bZ.Text.nodeValue=bZ.Value,bZ.Dirty=false):null;}else if(bY!=null&&bY.$==6){b0=bY.$0;w.iter(function(b4){return function(b5){ba.SyncElemNode(b4,b5);};}(false),b0.Holes);w.iter(function(b4){bs.Sync(b4[0],b4[1]);},b0.Attrs);return ba.AfterRender(b0);}else{b2=bY.$1;b3=bY.$0;ba.Sync(b3);bY=b2;}}};ba.AfterRender=function(bY){var bZ;bZ=bV.GetOptional(bY.Render);bZ!=null&&bZ.$==1?(bZ.$0(bY.El),bV.SetOptional(bY,"Render",null)):void 0;};ba.DoSyncElement=function(bY){var bZ,b0,b1;function b2(b3,b4){var b5,b6,b7,b8;while(true){if(b3!=null&&b3.$==1)return b3.$0.El;else if(b3!=null&&b3.$==2){b6=b3.$0;if(b6.Dirty){b6.Dirty=false;return ba.InsertDoc(bZ,b6.Current,b4);}else b3=b6.Current;}else if(b3==null)return b4;else if(b3!=null&&b3.$==4)return b3.$0.Text;else if(b3!=null&&b3.$==5)return b3.$0;else if(b3!=null&&b3.$==6){b5=b3.$0;b5.Dirty?b5.Dirty=false:void 0;return w.foldBack(function(b9,b_){return b9==null||b9.constructor===X?b2(b9,b_):b9;},b5.Els,b4);}else{b7=b3.$1;b8=b3.$0;b3=b8;b4=b2(b7,b4);}}}bZ=bY.El;bL.Iter((b0=bY.El,function(b3){bj.RemoveNode(b0,b3);}),bL.Except(bL.DocChildren(bY),bL.Children(bY.El,bV.GetOptional(bY.Delimiters))));b2(bY.Children,(b1=bV.GetOptional(bY.Delimiters),b1!=null&&b1.$==1?b1.$0[1]:null));};bb.$cctor=function(){bb.$cctor=a.ignore;bb.counter=0;};bd=d.OperationCanceledException=bV.Class({},bc,bd);bd.New=bV.Ctor(function(bY){bd.New$1.call(this,"The operation was canceled.",null,bY);},bd);bd.New$1=bV.Ctor(function(bY,bZ,b0){this.message=bY;this.inner=bZ;X.setPrototypeOf(this,bd.prototype);this.ct=b0;},bd);be=g.DocElemNode=bV.Class({Equals:function(bY){return this.ElKey===bY.ElKey;},GetHashCode:function(){return this.ElKey;}},null,be);be.New=function(bY,bZ,b0,b1,b2,b3){var b4;return new be((b4={Attr:bY,Children:bZ,El:b1,ElKey:b2},(bV.SetOptional(b4,"Delimiters",b0),bV.SetOptional(b4,"Render",b3),b4)));};bg=g.Elt=bV.Class({},Q,bg);bg.TreeNode=function(bY,bZ){var b0,b1;function b2(b3){return b3[1];}b0=bu.Create(bZ);return new bg.New$1({$:6,$0:bY},y.Map2Unit((b1=w.map(function(b3){return bs.Updates(b2(b3));},bY.Attrs),br.TreeReduce(y.Const(),y.Map2Unit,b1)),b0.v),w.get(bY.Els,0),b0);};bg.New$1=bV.Ctor(function(bY,bZ,b0,b1){Q.New.call(this,bY,bZ);this.docNode$1=bY;this.updates$1=bZ;this.elt=b0;this.rvUpdates=b1;},bg);bh.convertTextNode=function(bY){var bZ,b0,b1,b2,b3,b4;bZ=null;b0=0;b2=bY.textContent;b3=new a.RegExp(P.TextHoleRE(),"g");while(bZ=b3.exec(b2),bZ!==null){bY.parentNode.insertBefore(self.document.createTextNode(bi.string(b2,{$:1,$0:b0},{$:1,$0:b3.lastIndex-w.get(bZ,0).length-1})),bY);b0=b3.lastIndex;b4=self.document.createElement("span");b4.setAttribute("ws-replace",w.get(bZ,1).toLowerCase());bY.parentNode.insertBefore(b4,bY);}b3.lastIndex=0;bY.textContent=bi.string(b2,{$:1,$0:b0},null);};bh.failNotLoaded=function(bY){bR.warn("Instantiating non-loaded template",bY);};bh.fillTextHole=function(bY,bZ,b0){var b1;b1=bY.querySelector("[ws-replace]");return e.Equals(b1,null)?(bR.warn("Filling non-existent text hole",b0),null):(b1.parentNode.replaceChild(self.document.createTextNode(bZ),b1),{$:1,$0:b1.getAttribute("ws-replace")});};bh.removeHolesExcept=function(bY,bZ){function b0(b1){P.foreachNotPreserved(bY,"["+b1+"]",function(b2){if(!bZ.Contains(b2.getAttribute(b1)))b2.removeAttribute(b1);});}b0("ws-attr");b0("ws-onafterrender");b0("ws-var");P.foreachNotPreserved(bY,"[ws-hole]",function(b1){if(!bZ.Contains(b1.getAttribute("ws-hole"))){b1.removeAttribute("ws-hole");while(b1.hasChildNodes())b1.removeChild(b1.lastChild);}});P.foreachNotPreserved(bY,"[ws-replace]",function(b1){if(!bZ.Contains(b1.getAttribute("ws-replace")))b1.parentNode.removeChild(b1);});P.foreachNotPreserved(bY,"[ws-on]",function(b1){b1.setAttribute("ws-on",I.concat(" ",w.filter(function(b2){return bZ.Contains(w.get(I.SplitChars(b2,[":"],1),1));},I.SplitChars(b1.getAttribute("ws-on"),[" "],1))));});P.foreachNotPreserved(bY,"[ws-attr-holes]",function(b1){var b2,b3,b4,b5,b6;b2=I.SplitChars(b1.getAttribute("ws-attr-holes"),[" "],1);for(b3=0,b4=b2.length-1;b3<=b4;b3++){b5=w.get(b2,b3);b1.setAttribute(b5,(b6=new a.RegExp(P.TextHoleRE(),"g"),b1.getAttribute(b5).replace(b6,function(b7,b8){return bZ.Contains(b8)?b7:"";})));}});};bh.fillInstanceAttrs=function(bY,bZ){var b0,b1,b2,b3,b4;bh.convertAttrs(bZ);b0=bZ.nodeName.toLowerCase();b1=bY.querySelector("[ws-attr="+b0+"]");if(e.Equals(b1,null))bR.warn("Filling non-existent attr hole",b0);else{b1.removeAttribute("ws-attr");for(b2=0,b3=bZ.attributes.length-1;b2<=b3;b2++){b4=bZ.attributes.item(b2);b4.name==="class"&&b1.hasAttribute("class")?b1.setAttribute("class",b1.getAttribute("class")+" "+b4.nodeValue):b1.setAttribute(b4.name,b4.nodeValue);}}};bh.mapHoles=function(bY,bZ){function b0(b1){P.foreachNotPreserved(bY,"["+b1+"]",function(b2){var b3,b4;b3=(b4=null,[bZ.TryGetValue(b2.getAttribute(b1).toLowerCase(),{get:function(){return b4;},set:function(b5){b4=b5;}}),b4]);b3[0]?b2.setAttribute(b1,b3[1]):void 0;});}b0("ws-hole");b0("ws-replace");b0("ws-attr");b0("ws-onafterrender");b0("ws-var");P.foreachNotPreserved(bY,"[ws-on]",function(b1){b1.setAttribute("ws-on",I.concat(" ",w.map(function(b2){var b3,b4,b5;b3=I.SplitChars(b2,[":"],1);b4=(b5=null,[bZ.TryGetValue(w.get(b3,1),{get:function(){return b5;},set:function(b6){b5=b6;}}),b5]);return b4[0]?w.get(b3,0)+":"+b4[1]:b2;},I.SplitChars(b1.getAttribute("ws-on"),[" "],1))));});P.foreachNotPreserved(bY,"[ws-attr-holes]",function(b1){var b2,b3,b4;b2=I.SplitChars(b1.getAttribute("ws-attr-holes"),[" "],1);for(b3=0,b4=b2.length-1;b3<=b4;b3++)(function(){var b5;function b6(b7,b8){var b9;b9=n.KeyValue(b8);return b7.replace(new a.RegExp("\\${"+b9[0]+"}","ig"),"${"+b9[1]+"}");}b5=w.get(b2,b3);return b1.setAttribute(b5,(((bV.Curried3(F.fold))(b6))(b1.getAttribute(b5)))(bZ));}());});};bh.fill=function(bY,bZ,b0){while(true)if(bY.hasChildNodes())b0=bZ.insertBefore(bY.lastChild,b0);else return null;};bh.convertAttrs=function(bY){var b0,b1,b2,b3,b4,b5,b6,b7;function bZ(b8){var b9;b9=bY.getAttribute(b8);b9===null?void 0:bY.setAttribute(b8,b9.toLowerCase());}b0=bY.attributes;b1=[];b2=[];b3=[];for(b4=0,b5=b0.length-1;b4<=b5;b4++){b6=b0.item(b4);I.StartsWith(b6.nodeName,"ws-on")&&b6.nodeName!=="ws-onafterrender"&&b6.nodeName!=="ws-on"?(b1.push(b6.nodeName),b2.push(bi.string(b6.nodeName,{$:1,$0:"ws-on".length},null)+":"+b6.nodeValue.toLowerCase())):!I.StartsWith(b6.nodeName,"ws-")&&(new a.RegExp(P.TextHoleRE())).test(b6.nodeValue)?(b6.nodeValue=(b7=new a.RegExp(P.TextHoleRE(),"g"),b6.nodeValue.replace(b7,function(b8,b9){return"${"+b9.toLowerCase()+"}";})),b3.push(b6.nodeName)):void 0;}!(b2.length==0)?bY.setAttribute("ws-on",I.concat(" ",b2)):void 0;!(b3.length==0)?bY.setAttribute("ws-attr-holes",I.concat(" ",b3)):void 0;bZ("ws-hole");bZ("ws-replace");bZ("ws-attr");bZ("ws-onafterrender");bZ("ws-var");w.iter(function(b8){bY.removeAttribute(b8);},b1);};bi.string=function(bY,bZ,b0){return bZ==null?b0!=null&&b0.$==1?bY.slice(0,b0.$0+1):"":b0==null?bY.slice(bZ.$0):bY.slice(bZ.$0,b0.$0+1);};bj.ParseHTMLIntoFakeRoot=function(bY){var bZ,b0,b1,b2,b3;function b4(b5,b6){var b7;while(true)if(b6===0)return b5;else{b7=b6;b5=b5.lastChild;b6=b7-1;}}bZ=self.document.createElement("div");return!bj.rhtml().test(bY)?(bZ.appendChild(self.document.createTextNode(bY)),bZ):(b0=(b1=bj.rtagName().exec(bY),e.Equals(b1,null)?"":w.get(b1,1).toLowerCase()),(b2=(b3=(bj.wrapMap())[b0],b3?b3:bj.defaultWrap()),(bZ.innerHTML=b2[1]+bY.replace(bj.rxhtmlTag(),"<$1></$2>")+b2[2],b4(bZ,b2[0]))));};bj.ChildrenArray=function(bY){var bZ,b0,b1;bZ=[];for(b0=0,b1=bY.childNodes.length-1;b0<=b1;b0++)bZ.push(bY.childNodes[b0]);return bZ;};bj.rhtml=function(){bD.$cctor();return bD.rhtml;};bj.wrapMap=function(){bD.$cctor();return bD.wrapMap;};bj.defaultWrap=function(){bD.$cctor();return bD.defaultWrap;};bj.rxhtmlTag=function(){bD.$cctor();return bD.rxhtmlTag;};bj.rtagName=function(){bD.$cctor();return bD.rtagName;};bj.IterSelector=function(bY,bZ,b0){var b1,b2,b3;b1=bY.querySelectorAll(bZ);for(b2=0,b3=b1.length-1;b2<=b3;b2++)b0(b1[b2]);};bj.InsertAt=function(bY,bZ,b0){var b1;if(!(b0.parentNode===bY&&bZ===(b1=b0.nextSibling,e.Equals(b1,null)?null:b1)))bY.insertBefore(b0,bZ);};bj.RemoveNode=function(bY,bZ){if(bZ.parentNode===bY)bY.removeChild(bZ);};F.insufficient=function(){return n.FailWith("The input sequence has an insufficient number of elements.");};bk=L.KeyCollection=bV.Class({GetEnumerator$1:function(){return _5.Get(F.map(function(bY){return bY.K;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},f,bk);bk.New=bV.Ctor(function(bY){f.New.call(this);this.d=bY;},bk);bl.get_UseAnimations=function(){return bz.UseAnimations();};bl.Play=function(bY){var bZ;bZ=null;return H.Delay(function(){return H.Bind(bl.Run(a.ignore,bz.Actions(bY)),function(){bz.Finalize(bY);return H.Return(null);});});};bl.Append=function(bY,bZ){return{$:0,$0:bF.Append(bY.$0,bZ.$0)};};bl.Run=function(bY,bZ){var b0;function b1(b2){function b3(b4){return function(b5){var b6;b6=b5-b4;bZ.Compute(b6);bY();return b6<=b0?void a.requestAnimationFrame(function(b7){(b3(b4))(b7);}):b2();};}a.requestAnimationFrame(function(b4){(b3(b4))(b4);});}b0=bZ.Duration;return b0===0?H.Zero():H.FromContinuations(function(b2,b3,b4){return b1.apply(null,[b2,b3,b4]);});};bl.Concat=function(bY){return{$:0,$0:bF.Concat(F.map(bz.List,bY))};};bl.get_Empty=function(){return{$:0,$0:bF.Empty()};};bm.BatchUpdatesEnabled=function(){bA.$cctor();return bA.BatchUpdatesEnabled;};bn.StartProcessor=function(bY){var bZ;function b0(){var b1;b1=null;return H.Delay(function(){return H.Bind(bY,function(){var b2;b2=bZ[0];return b2===1?(bZ[0]=0,H.Zero()):b2===2?(bZ[0]=1,b0()):H.Zero();});});}bZ=[0];return function(){var b1;b1=bZ[0];b1===0?(bZ[0]=1,H.Start(b0(),null)):b1===1?bZ[0]=2:void 0;};};bp.New=function(bY,bZ,b0,b1){var b2;b2={DynElem:bY,DynFlags:bZ,DynNodes:b0};bV.SetOptional(b2,"OnAfterRender",b1);return b2;};bq.Clear=function(bY){bY.splice(0,w.length(bY));};br.mapInPlace=function(bY,bZ){var b0,b1;for(b0=0,b1=bZ.length-1;b0<=b1;b0++)bZ[b0]=bY(bZ[b0]);return bZ;};br.ofSeqNonCopying=function(bY){var bZ,b0;if(bY instanceof a.Array)return bY;else if(bY instanceof k)return w.ofList(bY);else if(bY===null)return[];else{bZ=[];b0=_5.Get(bY);try{while(b0.MoveNext())bZ.push(b0.Current());return bZ;}finally{if(typeof b0=="object"&&"Dispose"in b0)b0.Dispose();}}};br.TreeReduce=function(bY,bZ,b0){var b1;function b2(b3){return function(b4){var b5,b6;return b4<=0?bY:b4===1&&(b3>=0&&b3<b1)?w.get(b0,b3):(b6=b4/2>>0,bZ((b2(b3))(b6),(b2(b3+b6))(b4-b6)));};}b1=w.length(b0);return(b2(0))(b1);};br.MapTreeReduce=function(bY,bZ,b0,b1){var b2;function b3(b4){return function(b5){var b6,b7;return b5<=0?bZ:b5===1&&(b4>=0&&b4<b2)?bY(w.get(b1,b4)):(b7=b5/2>>0,b0((b3(b4))(b7),(b3(b4+b7))(b5-b7)));};}b2=w.length(b1);return(b3(0))(b2);};bs.Insert=function(bY,bZ){var b0,b1,b2;function b3(b4){var b5,b6;while(true)if(!(b4===null)){if(b4!=null&&b4.$==1)return b0.push(b4.$0);else if(b4!=null&&b4.$==2){b5=b4.$1;b6=b4.$0;b3(b6);b4=b5;}else return b4!=null&&b4.$==3?b4.$0(bY):b4!=null&&b4.$==4?b1.push(b4.$0):null;}else return null;}b0=[];b1=[];b3(bZ);b2=b0.slice(0);return bp.New(bY,bs.Flags(bZ),b2,b1.length===0?null:{$:1,$0:function(b4){F.iter(function(b5){b5(b4);},b1);}});};bs.Updates=function(bY){return br.MapTreeReduce(function(bZ){return bZ.NChanged();},y.Const(),y.Map2Unit,bY.DynNodes);};bs.Empty=function(bY){return bp.New(bY,0,[],null);};bs.Flags=function(bY){return bY!==null&&bY.hasOwnProperty("flags")?bY.flags:0;};bs.Static=function(bY){return new Y({$:3,$0:bY});};bs.Dynamic=function(bY,bZ){return new Y({$:1,$0:new bH.New(bY,bZ)});};bs.EmptyAttr=function(){bG.$cctor();return bG.EmptyAttr;};bs.HasExitAnim=function(bY){var bZ;bZ=2;return(bY.DynFlags&bZ)===bZ;};bs.GetExitAnim=function(bY){return bs.GetAnim(bY,function(bZ,b0){return bZ.NGetExitAnim(b0);});};bs.HasEnterAnim=function(bY){var bZ;bZ=1;return(bY.DynFlags&bZ)===bZ;};bs.GetEnterAnim=function(bY){return bs.GetAnim(bY,function(bZ,b0){return bZ.NGetEnterAnim(b0);});};bs.HasChangeAnim=function(bY){var bZ;bZ=4;return(bY.DynFlags&bZ)===bZ;};bs.GetChangeAnim=function(bY){return bs.GetAnim(bY,function(bZ,b0){return bZ.NGetChangeAnim(b0);});};bs.AppendTree=function(bY,bZ){var b0;return bY===null?bZ:bZ===null?bY:(b0=new Y({$:2,$0:bY,$1:bZ}),(bs.SetFlags(b0,bs.Flags(bY)|bs.Flags(bZ)),b0));};bs.GetAnim=function(bY,bZ){return bl.Concat(w.map(function(b0){return bZ(b0,bY.DynElem);},bY.DynNodes));};bs.Sync=function(bY,bZ){w.iter(function(b0){b0.NSync(bY);},bZ.DynNodes);};bs.SetFlags=function(bY,bZ){bY.flags=bZ;};bt.Handler=function(bY,bZ){return bs.Static(function(b0){b0.addEventListener(bY,function(b1){return(bZ(b0))(b1);},false);});};bt.OnAfterRender=function(bY){return new Y({$:4,$0:bY});};bt.Value=function(bY){var bZ;bZ=(((bC.StringApply())(bY))(bs.Static))(function(b0){return bt.DynamicCustom(b0,bY.get_View());});return Y.Append(bZ[0],bZ[1]);};bt.Checked=function(bY){var bZ;bZ=(((bC.BoolCheckedApply())(bY))(bs.Static))(function(b0){return bt.DynamicCustom(b0,bY.get_View());});return Y.Append(bZ[0],bZ[1]);};bt.IntValue=function(bY){var bZ;bZ=(((bC.IntApplyChecked())(bY))(bs.Static))(function(b0){return bt.DynamicCustom(b0,bY.get_View());});return Y.Append(bZ[0],bZ[1]);};bt.IntValueUnchecked=function(bY){var bZ;bZ=(((bC.IntApplyUnchecked())(bY))(bs.Static))(function(b0){return bt.DynamicCustom(b0,bY.get_View());});return Y.Append(bZ[0],bZ[1]);};bt.FloatValue=function(bY){var bZ;bZ=(((bC.FloatApplyChecked())(bY))(bs.Static))(function(b0){return bt.DynamicCustom(b0,bY.get_View());});return Y.Append(bZ[0],bZ[1]);};bt.FloatValueUnchecked=function(bY){var bZ;bZ=(((bC.FloatApplyUnchecked())(bY))(bs.Static))(function(b0){return bt.DynamicCustom(b0,bY.get_View());});return Y.Append(bZ[0],bZ[1]);};bt.Dynamic=function(bY,bZ){return bs.Dynamic(bZ,function(b0){return function(b1){return b0.setAttribute(bY,b1);};});};bt.DynamicCustom=function(bY,bZ){return bs.Dynamic(bZ,bY);};bu=g.Updates=bV.Class({},null,bu);bu.Create=function(bY){var bZ;bZ=null;bZ=bu.New(bY,null,function(){var b0;b0=bZ.s;return b0===null?(b0=D.Copy(bZ.c()),bZ.s=b0,D.WhenObsoleteRun(b0,function(){bZ.s=null;}),b0):b0;});return bZ;};bu.New=function(bY,bZ,b0){return new bu({c:bY,s:bZ,v:b0});};bv=L.ValueCollection=bV.Class({GetEnumerator$1:function(){return _5.Get(F.map(function(bY){return bY.V;},this.d));},GetEnumerator:function(){return this.GetEnumerator$1();},GetEnumerator0:function(){return this.GetEnumerator$1();}},f,bv);bv.New=bV.Ctor(function(bY){f.New.call(this);this.d=bY;},bv);bx.New=function(bY,bZ){return{PreviousNodes:bY,Top:bZ};};by.get_Empty=function(){return{$:0,$0:new _1.New$3()};};by.FindAll=function(bY){var bZ;function b0(b3,b4){var b5,b6,b7,b8,b9;while(true)switch(b3){case 0:if(b4!=null&&b4.$==0){b6=b4.$1;b7=b4.$0;b0(0,b7);b4=b6;}else if(b4!=null&&b4.$==1){b8=b4.$0;b4=b8;b3=1;}else if(b4!=null&&b4.$==2){b9=b4.$0;b4=b9.Current;}else return b4!=null&&b4.$==6?(b5=b4.$0.Holes,(function(b_){return function(b$){w.iter(b_,b$);};}(b2))(b5)):null;break;case 1:bZ.push(b4);b4=b4.Children;b3=0;break;}}function b1(b3){return b0(0,b3);}function b2(b3){return b0(1,b3);}bZ=[];b1(bY);return{$:0,$0:new _1.New$2(bZ)};};by.Filter=function(bY,bZ){return{$:0,$0:bJ.Filter(bY,bZ.$0)};};by.Except=function(bY,bZ){return{$:0,$0:bJ.Except(bY.$0,bZ.$0)};};by.ToArray=function(bY){return bJ.ToArray(bY.$0);};by.Intersect=function(bY,bZ){return{$:0,$0:bJ.Intersect(bY.$0,bZ.$0)};};bz.UseAnimations=function(){bE.$cctor();return bE.UseAnimations;};bz.Actions=function(bY){return bz.ConcatActions(w.choose(function(bZ){return bZ.$==1?{$:1,$0:bZ.$0}:null;},bF.ToArray(bY.$0)));};bz.Finalize=function(bY){w.iter(function(bZ){if(bZ.$==0)bZ.$0();},bF.ToArray(bY.$0));};bz.ConcatActions=function(bY){var bZ,b0,b1,b2;bZ=br.ofSeqNonCopying(bY);b0=w.length(bZ);return b0===0?bz.Const():b0===1?w.get(bZ,0):(b1=F.max(F.map(function(b3){return b3.Duration;},bZ)),(b2=w.map(function(b3){return bz.Prolong(b1,b3);},bZ),bz.Def(b1,function(b3){w.iter(function(b4){b4.Compute(b3);},b2);})));};bz.List=function(bY){return bY.$0;};bz.Const=function(bY){return bz.Def(0,function(){return bY;});};bz.Def=function(bY,bZ){return{Compute:bZ,Duration:bY};};bz.Prolong=function(bY,bZ){var b0,b1,b2;b0=bZ.Compute;b1=bZ.Duration;b2=bN.Create(function(){return bZ.Compute(bZ.Duration);});return{Compute:function(b3){return b3>=b1?b2.f():b0(b3);},Duration:bY};};bA.$cctor=function(){bA.$cctor=a.ignore;bA.BatchUpdatesEnabled=true;};bB.concat=function(bY){var bZ,b0;bZ=[];for(var b1 in bY)bZ.push.apply(bZ,bY[b1]);return bZ;};bC.StringApply=function(){bG.$cctor();return bG.StringApply;};bC.BoolCheckedApply=function(){bG.$cctor();return bG.BoolCheckedApply;};bC.IntApplyChecked=function(){bG.$cctor();return bG.IntApplyChecked;};bC.IntApplyUnchecked=function(){bG.$cctor();return bG.IntApplyUnchecked;};bC.FloatApplyChecked=function(){bG.$cctor();return bG.FloatApplyChecked;};bC.FloatApplyUnchecked=function(){bG.$cctor();return bG.FloatApplyUnchecked;};bC.ApplyValue=function(bY,bZ,b0,b1,b2){return[b1(function(b3){function b4(){b0.UpdateMaybe(function(b5){var b6,b7;b6=bY(b3);return b6!=null&&b6.$==1&&(!e.Equals(b6.$0,b5)&&(b7=[b6,b6.$0],true))?b7[0]:null;});}b3.addEventListener("change",b4);b3.addEventListener("input",b4);b3.addEventListener("keypress",b4);}),b2(function(b3){return function(b4){var b5,b6;b5=bY(b3);return b5!=null&&b5.$==1&&(e.Equals(b5.$0,b4)&&(b6=b5.$0,true))?null:bZ(b3,b4);};})];};bC.StringSet=function(){bG.$cctor();return bG.StringSet;};bC.StringGet=function(){bG.$cctor();return bG.StringGet;};bC.IntSetUnchecked=function(){bG.$cctor();return bG.IntSetUnchecked;};bC.IntGetUnchecked=function(){bG.$cctor();return bG.IntGetUnchecked;};bC.IntSetChecked=function(){bG.$cctor();return bG.IntSetChecked;};bC.IntGetChecked=function(){bG.$cctor();return bG.IntGetChecked;};bC.FloatSetUnchecked=function(){bG.$cctor();return bG.FloatSetUnchecked;};bC.FloatGetUnchecked=function(){bG.$cctor();return bG.FloatGetUnchecked;};bC.FloatSetChecked=function(){bG.$cctor();return bG.FloatSetChecked;};bC.FloatGetChecked=function(){bG.$cctor();return bG.FloatGetChecked;};bD.$cctor=function(){var bY;bD.$cctor=a.ignore;bD.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");bD.rtagName=new a.RegExp("<([\\w:]+)");bD.rhtml=new a.RegExp("<|&#?\\w+;");bD.wrapMap=(bY=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:bY,tbody:bY,tfoot:bY,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});bD.defaultWrap=[0,"",""];};bE.$cctor=function(){bE.$cctor=a.ignore;bE.CubicInOut=bI.Custom(function(bY){var bZ;bZ=bY*bY;return 3*bZ-2*(bZ*bY);});bE.UseAnimations=true;};bF.Append=function(bY,bZ){return bY.$==0?bZ:bZ.$==0?bY:{$:2,$0:bY,$1:bZ};};bF.ToArray=function(bY){var bZ;function b0(b1){var b2,b3;while(true)if(b1.$==1)return bZ.push(b1.$0);else if(b1.$==2){b2=b1.$1;b3=b1.$0;b0(b3);b1=b2;}else return b1.$==3?w.iter(function(b4){bZ.push(b4);},b1.$0):null;}bZ=[];b0(bY);return bZ.slice(0);};bF.Concat=function(bY){var bZ;bZ=br.ofSeqNonCopying(bY);return br.TreeReduce(bF.Empty(),bF.Append,bZ);};bF.Empty=function(){bO.$cctor();return bO.Empty;};bG.$cctor=function(){var bY,bZ,b0,b1,b2,b3,b4,b5,b6,b7;bG.$cctor=a.ignore;bG.EmptyAttr=null;bG.BoolCheckedApply=bV.Curried3(function(b8,b9,b_){return[b9(function(b$){b$.addEventListener("change",function(){return!e.Equals(b8.Get(),b$.checked)?b8.Set(b$.checked):null;});}),b_(function(b$){return function(ca){b$.checked=ca;};})];});bG.StringSet=function(b8){return function(b9){b8.value=b9;};};bG.StringGet=function(b8){return{$:1,$0:b8.value};};bG.StringApply=(bY=bC.StringGet(),(bZ=bC.StringSet(),bV.Curried(bC.ApplyValue,3,[bY,function(b8,b9){return(bZ(b8))(b9);}])));bG.IntSetUnchecked=function(b8){return function(b9){b8.value=a.String(b9);};};bG.IntGetUnchecked=function(b8){var b9,b_;b9=b8.value;return bK.isBlank(b9)?{$:1,$0:0}:(b_=+b9,b_!==b_>>0?null:{$:1,$0:b_});};bG.IntApplyUnchecked=(b0=bC.IntGetUnchecked(),(b1=bC.IntSetUnchecked(),bV.Curried(bC.ApplyValue,3,[b0,function(b8,b9){return(b1(b8))(b9);}])));bG.IntSetChecked=function(b8){return function(b9){var b_;b_=b9.get_Input();return b8.value!==b_?void(b8.value=b_):null;};};bG.IntGetChecked=function(b8){var b9,b_,b$;b9=b8.value;return{$:1,$0:bK.isBlank(b9)?(b8.checkValidity?b8.checkValidity():true)?new Z({$:2,$0:b9}):new Z({$:1,$0:b9}):(b_=(b$=0,[_0.TryParseInt32(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]),b_[0]?new Z({$:0,$0:b_[1],$1:b9}):new Z({$:1,$0:b9}))};};bG.IntApplyChecked=(b2=bC.IntGetChecked(),(b3=bC.IntSetChecked(),bV.Curried(bC.ApplyValue,3,[b2,function(b8,b9){return(b3(b8))(b9);}])));bG.FloatSetUnchecked=function(b8){return function(b9){b8.value=a.String(b9);};};bG.FloatGetUnchecked=function(b8){var b9,b_;b9=b8.value;return bK.isBlank(b9)?{$:1,$0:0}:(b_=+b9,a.isNaN(b_)?null:{$:1,$0:b_});};bG.FloatApplyUnchecked=(b4=bC.FloatGetUnchecked(),(b5=bC.FloatSetUnchecked(),bV.Curried(bC.ApplyValue,3,[b4,function(b8,b9){return(b5(b8))(b9);}])));bG.FloatSetChecked=function(b8){return function(b9){var b_;b_=b9.get_Input();return b8.value!==b_?void(b8.value=b_):null;};};bG.FloatGetChecked=function(b8){var b9,b_;b9=b8.value;return{$:1,$0:bK.isBlank(b9)?(b8.checkValidity?b8.checkValidity():true)?new Z({$:2,$0:b9}):new Z({$:1,$0:b9}):(b_=+b9,a.isNaN(b_)?new Z({$:1,$0:b9}):new Z({$:0,$0:b_,$1:b9}))};};bG.FloatApplyChecked=(b6=bC.FloatGetChecked(),(b7=bC.FloatSetChecked(),bV.Curried(bC.ApplyValue,3,[b6,function(b8,b9){return(b7(b8))(b9);}])));};bH=g.DynamicAttrNode=bV.Class({NChanged:function(){return this.updates;},NGetExitAnim:function(bY){return bl.get_Empty();},NGetEnterAnim:function(bY){return bl.get_Empty();},NGetChangeAnim:function(bY){return bl.get_Empty();},NSync:function(bY){if(this.dirty){(this.push(bY))(this.value);this.dirty=false;}}},f,bH);bH.New=bV.Ctor(function(bY,bZ){var b0;b0=this;f.New.call(this);this.push=bZ;this.value=void 0;this.dirty=false;this.updates=y.Map(function(b1){b0.value=b1;b0.dirty=true;},bY);},bH);bI=g.Easing=bV.Class({},f,bI);bI.Custom=function(bY){return new bI.New(bY);};bI.New=bV.Ctor(function(bY){f.New.call(this);this.transformTime=bY;},bI);bJ.Filter=function(bY,bZ){return new _1.New$2(w.filter(bY,bJ.ToArray(bZ)));};bJ.Except=function(bY,bZ){var b0;b0=new _1.New$2(bJ.ToArray(bZ));b0.ExceptWith(bJ.ToArray(bY));return b0;};bJ.ToArray=function(bY){var bZ;bZ=w.create(bY.get_Count(),void 0);bY.CopyTo(bZ);return bZ;};bJ.Intersect=function(bY,bZ){var b0;b0=new _1.New$2(bJ.ToArray(bY));b0.IntersectWith(bJ.ToArray(bZ));return b0;};bK.isBlank=function(bY){return I.forall(bM.IsWhiteSpace,bY);};bL.Children=function(bY,bZ){var b0,b1,b2;if(bZ!=null&&bZ.$==1){b2=[];b0=bZ.$0[0].nextSibling;while(b0!==bZ.$0[1]){b2.push(b0);b0=b0.nextSibling;}return{$:0,$0:b2};}else return{$:0,$0:w.init(bY.childNodes.length,(b1=bY.childNodes,function(b3){return b1[b3];}))};};bL.Except=function(bY,bZ){var b0;b0=bY.$0;return{$:0,$0:w.filter(function(b1){return w.forall(function(b2){return!(b1===b2);},b0);},bZ.$0)};};bL.Iter=function(bY,bZ){w.iter(bY,bZ.$0);};bL.DocChildren=function(bY){var bZ;function b0(b1){var b2,b3,b4,b5;while(true){if(b1!=null&&b1.$==2){b3=b1.$0;b1=b3.Current;}else if(b1!=null&&b1.$==1)return bZ.push(b1.$0.El);else if(b1==null)return null;else if(b1!=null&&b1.$==5)return bZ.push(b1.$0);else if(b1!=null&&b1.$==4)return bZ.push(b1.$0.Text);else if(b1!=null&&b1.$==6){b2=b1.$0.Els;return(function(b6){return function(b7){w.iter(b6,b7);};}(function(b6){if(b6==null||b6.constructor===X)b0(b6);else bZ.push(b6);}))(b2);}else{b4=b1.$1;b5=b1.$0;b0(b5);b1=b4;}}}bZ=[];b0(bY.Children);return{$:0,$0:br.ofSeqNonCopying(bZ)};};bM.IsWhiteSpace=function(bY){return bY.match(new a.RegExp("\\s"))!==null;};_0.TryParse=function(bY,bZ,b0,b1){var b2,b3;b2=+bY;b3=b2===b2-b2%1&&b2>=bZ&&b2<=b0;b3?b1.set(b2):void 0;return b3;};bN.Create=function(bY){return bQ.New(false,bY,bN.forceLazy);};bN.forceLazy=function(){var bY;bY=this.v();this.c=true;this.v=bY;this.f=bN.cachedLazy;return bY;};bN.cachedLazy=function(){return this.v;};bO.$cctor=function(){bO.$cctor=a.ignore;bO.Empty={$:0};};bQ.New=function(bY,bZ,b0){return{c:bY,v:bZ,f:b0};};bV.OnLoad(function(){c.Main();});}());


if (typeof IntelliFactory !=='undefined') {
  IntelliFactory.Runtime.ScriptBasePath = '/Content/';
  IntelliFactory.Runtime.Start();
}
